Vue.component("downloadExcel",JsonExcel);let vm=new Vue({vuetify:vuetify,el:"#full-learning-container",data:{tab:null,nav_tab:null,course_tab:null,list_tab:null,snackbar:!1,stepper:1,snackbar_text:"",snackbar_timeout:2e4,loading:!1,add_loading:!1,coupon_loading:!1,certified_loading:!1,search_user_loading:!1,reminder_loading:!1,my_orders_loading:!1,coupon_field:!1,dialog:!1,dialogUserRemove:!1,sponsorViewsStatistics:!1,valid:!1,searched:!1,stepper_dialog:!0,dialogDelete:!1,modal:!1,modal_course:!0,alert:!1,alert_type:"",alert_message:"",coupon_code:"",course_id:"",search_students_pendings:"",user_search:"",user_selected:{},requiredField:[e=>!!e||"Este campo es requerido"],rol_selected:"estudiante",notifications:[],users_list:[],sections:[],quizzes:{loading:!1,search:"",excel:{header:{"Nombre completo":"full_name"},students:[]},headers:[],quizzes:[],students:[]},rol_list:[{text:"Estudiante",value:"estudiante"},{text:"Residente",value:"residente"},{text:"Oyente",value:"oyente"}],class_views:{loading:!1,quizzes_loading:!1,total_views_loading:!1,total_views_dialog:!1,total_course_loading:!1,total_course_zoom:0,total_course_video:0,total_quizzes_done:0,search:"",items:[],headers:[{text:"Nombre completo",value:"full_name",align:"start",filterable:!0},{text:"Correo electrónico",value:"email"},{text:"Zoom",value:"zoom"},{text:"Video",value:"video"}],excel:{total_quizzes_header:{Clase:"lesson_name",Estudiantes:"students"},total_views_headers:{Clase:"lesson_name",Zoom:"zoom_views",Video:"video_views"}},total_views_headers:[{text:"Clase",value:"lesson_name",align:"start",filterable:!0},{text:"Zoom",value:"zoom_views"},{text:"Video",value:"video_views"}],quizzes_done_headers:[{text:"Clase",value:"lesson_name",align:"start",filterable:!0},{text:"Estudiantes",value:"students"}],editedItem:{items:[],section_id:"",section_name:""}},students_enrolled:{loading:!1,search:"",items:[],headers:[{text:"Nombre completo",value:"full_name",align:"start",filterable:!0},{text:"Correo electrónico",value:"email"},{text:"Provincia / País",value:"location"},{text:"Teléfono",value:"meta.telephone"},{text:"Acciones",value:"actions",align:"center",sortable:!1}]},gratuated_students:{loading:!1,search:"",items:[],headers:[{text:"Nombre completo",value:"full_name",align:"start",filterable:!0},{text:"Correo electrónico",value:"email"},{text:"Acciones",value:"actions",align:"center",sortable:!1}]},listeners:{loading:!1,search:"",items:[],headers:[{text:"Nombre completo",value:"full_name",align:"start",filterable:!0},{text:"Correo electrónico",value:"email"},{text:"Acciones",value:"actions",align:"center",sortable:!1}]},students_pendings:{loading:!1,search:"",items:[],headers:[{text:"Nombre completo",value:"full_name",align:"start",filterable:!0},{text:"Correo electrónico",value:"email"},{text:"Recordatorio",value:"reminder",align:"center"}]},instructors_pendings:{loading:!1,search:"",items:[],headers:[{text:"Nombre completo",value:"full_name",align:"start",filterable:!0},{text:"Correo electrónico",value:"email"},{text:"Recordatorio",value:"reminder",align:"center"}]},rating:{my_rating:{},items:[],loading:!1,form_valid:!0,form_loading:!1,myCommentIsPublished:!1,form_rules:{comment:[e=>!!e||"Es requerido escribir un comentario",e=>e&&e.length<=10||"Debe ser un comentario mayor a 10 caracteres"]},form:{comment:"",stars:5},defaultForm:{comment:"",stars:5}},my_progress:{progress:"N/A",quizzes_approved:0,total_quizzes:0,quizzes:[],certified:""},orders:{items:[],headers:[{text:"ID",align:"start",value:"order_id"},{text:"Fecha",align:"start",value:"registered_at"},{text:"Monto",align:"start",value:"amount"},{text:"Método de Pago",align:"start",value:"payment_method"}],editedIndex:-1,editedItem:{}},sponsors:[],sponsors_posts_filtered:[],sponsors_posts:[],sponsor_statistics:{loading:!1,headers:[{text:"Patrocinador",value:"sponsor_name",align:"start"},{text:"Clicks totales",value:"total"}],items:[]},editedIndex:-1,editedItem:{},defaultItem:{}},computed:{},watch:{dialogUserRemove(e){e||this.closeDelete()},sponsorViewsStatistics(e){this.getSponsorViewsStatistics()}},created(){check_google_user()},mounted(){this.course_id=this.$refs.course_container.getAttribute("course_id"),null!=url_params.get("course_tab")&&(this.course_tab=url_params.get("course_tab"),setTimeout(()=>{this.$refs.tabs_section.$el.scrollIntoView({behavior:"smooth"})},2e3)),this.initialize(),this.initializePendingStudents(),this.initializePendingInstructors(),this.initializeSections(),this.initializeSponsors(),this.initializeSponsorsPosts(),this.initializeComments(),this.initializeCourseProgress(),this.initializeCourseOrders()},methods:{initialize(){var e=this,s=api_url+"course-students/get-students/"+e.course_id;e.students_enrolled.loading=!0,e.$http.get(s).then(s=>{e.students_enrolled.loading=!1,e.students_enrolled.items=s.body,e.students_enrolled.items.length>0&&e.initializeStudentsQuizzes()},e=>{}),s=api_url+"course-students/get-students-approved/"+e.course_id,e.$http.post(s).then(s=>{e.gratuated_students.loading=!1,e.gratuated_students.items=s.body},e=>{}),s=api_url+"course-students/get-users/"+e.course_id,e.$http.post(s,{rol:"oyente"}).then(s=>{e.listeners.loading=!1,e.listeners.items=s.body},e=>{})},initializeSections(){var e=this,s={course_id:e.course_id},t=api_url+"course-sections/get-only-classes";e.$http.post(t,s).then(s=>{e.sections=s.body},e=>{})},initializeSponsors(){var e=this,s=api_url+"sponsors/get-by-course/"+e.course_id;e.$http.get(s).then(s=>{s.body.length>0&&(e.sponsors=s.body)},e=>{})},initializeSponsorsPosts(){var e=this,s=api_url+"sponsors-posts/get/"+e.course_id;e.$http.get(s).then(s=>{s.body.length>0&&(e.sponsors_posts_filtered=_.shuffle(s.body),e.sponsors_posts=s.body)},e=>{})},initializeStudentsQuizzes(){var e=this,s=api_url+"lesson-quizzes-reports/get/"+e.course_id,t=e.quizzes.excel;e.$http.get(s).then(s=>{if(s.body.hasOwnProperty("quizzes")&&s.body.hasOwnProperty("students_quizzes")){var i=e.quizzes.headers;i.push({text:"Nombre completo",value:"full_name"}),s.body.quizzes.forEach(e=>{var s={};s.text=e.lesson_name,s.value=e.lesson_id,s.align="start",i.push(s),t.header[s.text]=parseInt(s.value)}),e.quizzes.items=s.body.quizzes,e.quizzes.headers=i;e.students_enrolled.items.forEach(i=>{item={full_name:i.full_name,user_id:i.user_id},excel_item={full_name:item.full_name},s.body.students_quizzes.forEach(e=>{e.user_id==i.user_id&&(item[e.lesson_id]=e.score,excel_item[e.lesson_id]=e.score)}),e.quizzes.students.push(item),t.students.push(excel_item)}),t.students=_.orderBy(t.students,["full_name"],["asc"])}},e=>{})},initializePendingStudents(){var e=this,s=api_url+"course-students/get-pending-students/"+e.course_id;e.students_pendings.loading=!0,e.$http.get(s).then(s=>{e.students_pendings.loading=!1,e.students_pendings.items=s.body},e=>{})},initializePendingInstructors(){var e=this,s=api_url+"course-students/get-pending-instructors/"+e.course_id;e.instructors_pendings.loading=!0,e.$http.get(s).then(s=>{e.instructors_pendings.loading=!1,e.instructors_pendings.items=s.body},e=>{})},initializeComments(){var e=this,s=api_url+"course-ratings/get/"+e.course_id;e.rating.loading=!0,e.$http.get(s).then(s=>{e.rating.items=s.body},e=>{});s=api_url+"course-ratings/get-mine/"+e.course_id;e.$http.post(s).then(s=>{s.body.length>0&&(e.rating.myCommentIsPublished=!0,s.body[0].stars=parseInt(s.body[0].stars),e.rating.my_rating=s.body[0]),e.rating.loading=!1},e=>{})},initializeCourseProgress(){var e=this,s={course_id:e.course_id},t=api_url+"course-students/get-student-progress-total";e.certified_loading=!0,e.$http.post(t,s).then(s=>{e.my_progress=s.body,e.certified_loading=!1},s=>{e.certified_loading=!1})},initializeCourseOrders(){var e=this,s=api_url+"orders/get-course-orders/"+e.course_id;e.my_orders_loading=!0;var t=Intl.DateTimeFormat().resolvedOptions();e.$http.post(s,{timezone:t.timeZone}).then(s=>{s.body.length>0&&(e.orders.items=s.body),e.my_orders_loading=!1},s=>{e.my_orders_loading=!1})},getSponsorViewsStatistics(e){var s=this;s.class_views.loading=!0;var t=api_url+"sponsor-views/get-total/"+s.course_id;s.$http.get(t).then(e=>{s.sponsor_statistics.loading=!1,s.sponsor_statistics.items=e.body},e=>{s.sponsor_statistics.loading=!1})},getSectionTotalViews(e){var s=this;s.class_views.editedItem.items=[],s.class_views.editedItem=Object.assign({},e),s.class_views.editedItem.quizzes=[],s.class_views.total_views_dialog=!0;var t=api_url+"course-sections/get-total-views/";s.class_views.total_views_loading=!0,s.class_views.quizzes_loading=!0;var i={section_id:e.section_id,course_id:s.course_id};s.$http.post(t,i).then(e=>{s.class_views.total_views_loading=!1,s.class_views.editedItem.items=e.body},e=>{}),t=api_url+"course-sections/get-total-quizzes-done/",s.$http.post(t,i).then(e=>{s.class_views.quizzes_loading=!1,s.class_views.editedItem.quizzes=e.body},e=>{})},getCourseTotalViews(){var e=this;e.class_views.total_course_loading=!0;var s=api_url+"courses/get-total-views/",t={sections:e.sections,course_id:e.course_id};e.$http.post(s,t).then(s=>{e.class_views.total_course_loading=!1,e.class_views.total_course_video=s.body.total_video_views,e.class_views.total_course_zoom=s.body.total_zoom_views,e.class_views.total_quizzes_done=s.body.total_quizzes_done},s=>{e.class_views.total_course_loading=!1})},saveSponsorView(e){var s=this;s.$http.post(api_url+"sponsor-views/create",{sponsor_id:e,course_id:s.course_id}).then(e=>{})},saveSponsorPostView(e){var s=this;s.$http.post(api_url+"sponsor-post-views/create",{sponsor_post_id:e,course_id:s.course_id}).then(e=>{console.log(e)})},getLessonViews(e){var s=this;s.class_views.items=[],s.class_views.excel.students=[],s.class_views.loading=!0;var t={course_id:s.course_id,lesson_id:e.lesson_id},i=api_url+"lessons/get-classes";s.$http.post(i,t).then(e=>{s.class_views.loading=!1;var t=s.class_views.excel;e.body.length>0&&(e.body.forEach(e=>{s.class_views.items.push(e);var i=0==parseInt(e.zoom_view)?"Sí":"No",o=0==parseInt(e.video_view)?"Sí":"No";t.students.push({full_name:e.full_name,zoom_view:i,video_view:o})}),t.students=_.orderBy(t.students,["full_name"],["asc"]))},e=>{s.class_views.loading=!1})},filterSponsorPosts(e){var s=this;s.saveSponsorView(e);var t=_.filter(s.sponsors_posts,s=>s.sponsor_id==e),i=_.filter(s.sponsors_posts,s=>s.sponsor_id!=e);s.sponsors_posts_filtered=t,i.forEach(e=>{s.sponsors_posts_filtered.push(e)})},searchUser(){var e=this,s=api_url+"members/search-user/"+e.user_search;e.user_selected="",e.search_user_loading=!0,e.$http.get(s).then(s=>{e.search_user_loading=!1,e.searched=!0,e.users_list=s.body},e=>{})},addUser(){var e=this;if(e.alert=!1,e.checkStudent(e.user_selected))e.alert=!0,e.alert_message="El usuario ya se encuentra añadido al curso",e.alert_type="warning";else{e.add_loading=!0;var s=api_url+"courses/add-student",t={course_id:e.course_id,user_id:e.user_selected.user_id,user_rol:e.rol_selected};e.$http.post(s,t).then(s=>{"success"==s.body.status&&e.initialize(),e.alert=!0,e.alert_type=s.body.status,e.alert_message=s.body.message,e.add_loading=!1},s=>{e.add_loading=!1})}},checkStudent(e){var s=this,t=s.students_enrolled.items.filter(s=>s.user_id==e.user_id),i=s.listeners.items.filter(s=>s.user_id==e.user_id);return t.length>0||i.length>0},editItem(e){var s=this;s.editedIndex=s.students_enrolled.items.indexOf(e),s.editedItem=Object.assign({},e),s.dialog=!0},deleteItem(e,s=""){var t=this;e.rol=s,t.editedIndex="oyente"==s?t.listeners.items.indexOf(e):t.students_enrolled.items.indexOf(e),t.editedItem=Object.assign({},e),t.dialogUserRemove=!0},remindUsers(e=[],s=!1){var t=this;t.snackbar=!1;var i=[e];if(s){t.reminder_loading=!0;i=Object.assign({},t.students_pendings.items)}var o={course_id:t.course_id,students:i},r=api_url+"emails/remind-users-pending/";t.$http.post(r,o).then(e=>{t.reminder_loading=!1,t.snackbar=!0,t.snackbar_text="Se envió el correo recordatorio al usuario",s&&(t.snackbar_text="Se envió el correo recordatorio a los usuarios"),t.snackbar_type="primary"},e=>{t.reminder_loading=!1,t.snackbar=!0,t.snackbar_text="Error inesperado, intente de nuevo",t.snackbar_type="error"})},remindUsersCourseProgress(e=[],s=!1){var t=this;t.snackbar=!1;var i=[e];if(s){t.reminder_loading=!0;i=Object.assign({},t.students_enrolled.items)}var o={course_id:t.course_id,students:i},r=api_url+"emails/remind-users-course-progress/";t.$http.post(r,o).then(e=>{t.reminder_loading=!1,t.snackbar=!0,t.snackbar_text="Se envió el correo recordatorio al usuario",s&&(t.snackbar_text="Se envió el correo recordatorio a los usuarios"),t.snackbar_type="primary"},e=>{t.reminder_loading=!1,t.snackbar=!0,t.snackbar_text="Error inesperado, intente de nuevo",t.snackbar_type="error"})},remindInstructors(e=[],s=!1){var t=this;t.snackbar=!1;var i=[e];if(s){t.reminder_loading=!0;i=Object.assign({},t.instructors_pendings.items)}var o={course_id:t.course_id,students:i},r=api_url+"emails/remind-instructors-pending/";t.$http.post(r,o).then(e=>{t.reminder_loading=!1,t.snackbar=!0,t.snackbar_text="Se envió el correo recordatorio al profesor",s&&(t.snackbar_text="Se envió el correo recordatorio a los profesores"),t.snackbar_type="primary"},e=>{t.reminder_loading=!1,t.snackbar=!0,t.snackbar_text="Error inesperado, intente de nuevo",t.snackbar_type="error"})},deleteItemConfirm(){var e=this,s=e.editedItem.user_id,t=api_url+"course-students/remove-user",i={course_id:e.course_id,user_id:s};console.log(i),e.$http.post(t,i).then(s=>{"oyente"==e.editedItem.rol?e.listeners.items.splice(e.editedIndex,1):e.students_enrolled.items.splice(e.editedIndex,1),e.closeDelete()},s=>{e.closeDelete()})},closeDelete(){this.dialogUserRemove=!1,this.$nextTick(()=>{this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1})},save(){var e=this,s=e.editedIndex,t=e.editedItem;if(e.editedIndex>-1){var i=api_url+"members/update";e.$http.post(i,t).then(i=>{"success"==i.body.status&&Object.assign(e.members[s],t),e.close()},e=>{})}else{i=api_url+"members/create";e.$http.post(i,t).then(s=>{t.date=current_date,"success"==s.body.status&&(t.user_id=s.body.data.user_id,e.members.push(t)),e.close()},s=>{e.close()})}},saveRating(){var e=this,s=api_url+"course-ratings/create";if(!e.$refs.rating_form.validate())return!1;e.rating.form_loading=!0;var t={course_id:e.course_id,comment:e.rating.form.comment,stars:e.rating.form.stars};e.$http.post(s,t).then(s=>{e.rating.form_loading=!1,"success"==s.body.status&&(t.published_at=moment().format("YYYY-MM-DD h:mm:ss"),t.course_rating_id=s.body.data.course_rating_id,e.rating.my_rating=t,e.rating.myCommentIsPublished=!0)},s=>{e.rating.form_loading=!1})},editMyRating(){var e=this,s=api_url+"course-ratings/update";e.rating.form_loading=!0,e.rating.form.course_id=e.course_id,e.$http.post(s,e.rating.form).then(s=>{e.rating.form_loading=!1,"success"==s.body.status&&(e.rating.my_rating=e.rating.form,e.rating.myCommentIsPublished=!0)},s=>{e.rating.form_loading=!1})},deleteRating(e,s){var t=this,i=api_url+"course-ratings/delete";t.$http.post(i,{course_rating_id:e.course_rating_id}).then(e=>{"success"==e.body.status&&t.rating.items.splice(s,1)},e=>{})},deleteMyRating(){var e=this,s=api_url+"course-ratings/delete";e.$http.post(s,{course_rating_id:e.rating.my_rating.course_rating_id}).then(s=>{"success"==s.body.status&&(e.rating.myCommentIsPublished=!1,e.rating.my_rating={},e.rating.form=Object.assign({},e.rating.defaultForm))},e=>{})},enrollToCourse(e){var s=this,t=api_url+"course-students/enroll-free-course",i={course_id:e};s.coupon_loading=!0,s.$http.post(t,i).then(e=>{s.coupon_loading=!1,s.alert=!0,s.alert_type=e.body.status,s.alert_message=e.body.message,"success"==e.body.status&&location.reload()},e=>{s.coupon_loading=!1})},openTab(e){window.scrollTo(0,this.$refs.tabs_section.$el.scrollWidth),this.course_tab=e},setCookie(){var e=this;let s="",t=new Date;t.setTime(t.getTime()+31536e6),s="; expires="+t.toUTCString(),document.cookie="modalv1_course_"+e.course_id+"=closed"+s+"; path=/",e.modal_course=!1},validate(){this.$refs.form.validate()},saveFile(e,s){var t=this;s=void 0===s?t:s;var i=e.substring(e.lastIndexOf("/")+1).split("?")[0];t.$http.get(e,{responseType:"blob",progress(e){}}).then(e=>{var s=document.createElement("a");s.href=window.URL.createObjectURL(e.body),s.download=i,s.style.display="none",document.body.appendChild(s),s.click(),delete s})}}});