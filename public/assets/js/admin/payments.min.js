moment.locale(app_language);let vm=new Vue({vuetify:vuetify,el:"#app-container",data:{previewImage:"",snackbar:!1,snackbar_text:"",snackbar_timeout:3e3,loading:!1,table_loading:!1,btn_approve_loading:!1,approve_loading:!1,dialog:!1,dialogOrderPreview:!1,dialogOrderDelete:!1,rejectDialog:!1,dialogOrderRefund:!1,valid:!1,drawer:!0,modal:!1,selectedItem:5,orders:{search:"",items:[],headers:[{text:"ID",align:"start",value:"order_id"},{text:"Data",align:"start",value:"registered_at"},{text:"Suma",align:"start",value:"amount"},{text:"Metoda de plată",align:"start",value:"payment_method"},{text:"Stat",align:"start",value:"status"},{text:"Acțiuni",value:"actions",align:"center",sortable:!1}],editedIndex:-1,editedItem:{},defaultItem:{name:"",meta:{}}}},computed:{FullName(){return this.orders.editedItem.meta.first_name+" "+this.orders.editedItem.meta.last_name}},watch:{dialog(val){val||this.close()},dialogOrderPreview(val){val||this.closeOrderPreview()},dialogOrderDelete(val){val||this.closeOrderDelete()},dialogOrderRefund(val){val||this.closeOrderRefund()}},created(){window.onload=()=>{check_google_user()},this.editedItem=this.defaultItem,this.initialize(),this.initializeOrders()},mounted(){},methods:{initialize(){var url=api_url+"payments/get";this.table_loading=!0,this.$http.get(url).then(res=>{this.table_loading=!1,this.payments.items=res.body},err=>{})},initializeOrders(){var url=api_url+"orders/get";this.table_loading=!0;var clientDateTime=Intl.DateTimeFormat().resolvedOptions();this.$http.post(url,{timezone:clientDateTime.timeZone}).then(res=>{this.table_loading=!1,this.orders.items=res.body,this.filterProcessingOrder()},err=>{})},filterProcessingOrder(){var app=this,items=app.orders.items.filter(item=>0==parseInt(item.status));app.orders.processing_items=items},editItem(item){this.payments.editedIndex=this.payments.items.indexOf(item),this.payments.editedItem=Object.assign({},item),this.dialog=!0},previewOrderItem(item){this.orders.editedIndex=this.orders.items.indexOf(item),this.orders.editedItem=Object.assign({},item),this.dialogOrderPreview=!0},deleteOrderItem(item){this.orders.items.editedIndex=this.orders.items.indexOf(item),this.orders.editedItem=Object.assign({},item),this.dialogOrderDelete=!0},deleteOrderItemConfirm(){var id=this.orders.editedItem.order_id,url=api_url+"orders/delete";this.$http.post(url,{order_id:id}).then(res=>{this.orders.items.splice(this.editedIndex,1),this.closeOrderDelete(),this.filterProcessingOrder()},err=>{this.closeOrderDelete()})},refundOrderItemConfirm(){var app=this,order=app.orders.editedItem,id=order.order_id,url=api_url+`refunds/${order.payment_method.toLowerCase()}/${id}`;app.$http.get(url).then(res=>{app.snackbar=!0,app.snackbar_text=res.body.message,"success"==res.body.status&&(order.status=3,Object.assign(order.meta,res.body.data),Object.assign(app.orders.items[app.orders.editedIndex],app.orders.editedItem)),app.closeOrderRefund()},err=>{app.closeOrderRefund()})},closeDelete(){this.dialogDelete=!1,this.$nextTick(()=>{this.payments.editedItem=Object.assign({},this.payments.defaultItem),this.payments.editedIndex=-1})},closeOrderDelete(){this.dialogOrderDelete=!1,this.$nextTick(()=>{this.orders.editedItem=Object.assign({},this.orders.defaultItem),this.orders.editedIndex=-1})},closeOrderRefund(){this.dialogOrderRefund=!1},close(){this.dialog=!1,this.$nextTick(()=>{this.payments.editedItem=Object.assign({},this.payments.defaultItem),this.payments.editedIndex=-1})},closeOrderPreview(){this.dialogOrderPreview=!1,this.$nextTick(()=>{this.orders.editedItem=Object.assign({},this.orders.defaultItem),this.orders.editedIndex=-1})},save(){var app=this;app.loading=!0;var payment=app.payments.editedItem;let data=new FormData;data.append("payment_method_id",payment.payment_method_id),data.append("meta",JSON.stringify(payment.meta));var editedIndex=app.payments.editedIndex,url=api_url+"payments/update";app.$http.post(url,data).then(res=>{"success"==res.body.status&&Object.assign(app.payments.items[editedIndex],payment),app.close(),app.loading=!1},err=>{app.loading=!1})},processOrder(action=1){var app=this,method,url=api_url+"orders/"+(1===action?"approve":"reject")+"/"+app.orders.editedItem.order_id;app.approve_loading=!0;var data=app.orders.editedItem;data.course_title=app.orders.editedItem.meta.hasOwnProperty("course")?app.orders.editedItem.meta.course:"",app.$http.post(url,data).then(res=>{app.approve_loading=!1,"success"==res.body.status&&(app.orders.editedItem.status=action,Object.assign(app.orders.items[app.orders.editedIndex],app.orders.editedItem),app.filterProcessingOrder(),app.rejectDialog=!1,app.dialogOrderPreview=!1)},err=>{})},getStatus(status){switch(parseInt(status)){case 0:return{color:"warning",name:"Prelucrare"};case 1:return{color:"success",name:"Aprobat"};case 2:return{color:"error",name:"Respins"};case 3:return{color:"primary",name:"Rambursat"}}}}});