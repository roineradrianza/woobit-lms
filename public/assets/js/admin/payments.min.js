moment.locale("es");let vm=new Vue({vuetify:vuetify,el:"#full-learning-container",data:{previewImage:"",loading:!1,table_loading:!1,btn_approve_loading:!1,approve_loading:!1,dialog:!1,dialogOrderPreview:!1,dialogOrderDelete:!1,rejectDialog:!1,valid:!1,drawer:!0,modal:!1,selectedItem:5,validations:{email:[e=>!!e||"El correo electrónico es valido",e=>/.+@.+\..+/.test(e)||"Debe ser un correo electrónico"]},true_false:[{text:"Activo",value:"1"},{text:"Inactivo",value:"0"}],payments:{items:[],processing_items:[],headers:[{text:"Nombre",align:"start",value:"name"},{text:"Acciones",value:"actions",align:"center",sortable:!1}],editedIndex:-1,editedItem:{},defaultItem:{name:"",meta:{}}},orders:{search:"",items:[],headers:[{text:"ID",align:"start",value:"order_id"},{text:"Fecha",align:"start",value:"registered_at"},{text:"Monto",align:"start",value:"amount"},{text:"Método de Pago",align:"start",value:"payment_method"},{text:"Estado",align:"start",value:"status"},{text:"Acciones",value:"actions",align:"center",sortable:!1}],editedIndex:-1,editedItem:{},defaultItem:{name:"",meta:{}}}},computed:{FullName(){return this.orders.editedItem.meta.first_name+" "+this.orders.editedItem.meta.last_name},formTitle(){return-1===this.editedIndex?"Crear método de pago":"Editar método de pago"},AmountInBs(){var e=this.orders.editedItem.meta.tax_day*this.orders.editedItem.total_pay,t=.16*e;e+=t;var i=new Intl.NumberFormat("es-ES",{style:"currency",currency:"VES"});return i.format(e)}},watch:{dialog(e){e||this.close()},dialogOrderPreview(e){e||this.closeOrderPreview()},dialogOrderDelete(e){e||this.closeOrderDelete()}},created(){window.onload=(()=>{check_google_user()}),this.editedItem=this.defaultItem,this.initialize(),this.initializeOrders()},mounted(){},methods:{initialize(){var e=api_url+"payments/get";this.table_loading=!0,this.$http.get(e).then(e=>{this.table_loading=!1,this.payments.items=e.body},e=>{})},initializeOrders(){var e=api_url+"orders/get";this.table_loading=!0;var t=Intl.DateTimeFormat().resolvedOptions();this.$http.post(e,{timezone:t.timeZone}).then(e=>{this.table_loading=!1,this.orders.items=e.body,this.filterProcessingOrder()},e=>{})},filterProcessingOrder(){var e=this,t=e.orders.items.filter(e=>0==parseInt(e.status));e.orders.processing_items=t},editItem(e){this.payments.editedIndex=this.payments.items.indexOf(e),this.payments.editedItem=Object.assign({},e),this.dialog=!0},previewOrderItem(e){this.orders.editedIndex=this.orders.items.indexOf(e),this.orders.editedItem=Object.assign({},e),this.dialogOrderPreview=!0},deleteOrderItem(e){this.orders.items.editedIndex=this.orders.items.indexOf(e),this.orders.editedItem=Object.assign({},e),this.dialogOrderDelete=!0},deleteOrderItemConfirm(){var e=this.orders.editedItem.order_id,t=api_url+"orders/delete";this.$http.post(t,{order_id:e}).then(e=>{this.orders.items.splice(this.editedIndex,1),this.closeOrderDelete(),this.filterProcessingOrder()},e=>{this.closeOrderDelete()})},closeDelete(){this.dialogDelete=!1,this.$nextTick(()=>{this.payments.editedItem=Object.assign({},this.payments.defaultItem),this.payments.editedIndex=-1})},closeOrderDelete(){this.dialogOrderDelete=!1,this.$nextTick(()=>{this.orders.editedItem=Object.assign({},this.orders.defaultItem),this.orders.editedIndex=-1})},close(){this.dialog=!1,this.$nextTick(()=>{this.payments.editedItem=Object.assign({},this.payments.defaultItem),this.payments.editedIndex=-1})},closeOrderPreview(){this.dialogOrderPreview=!1,this.$nextTick(()=>{this.orders.editedItem=Object.assign({},this.orders.defaultItem),this.orders.editedIndex=-1})},save(){var e=this;e.loading=!0;var t=e.payments.editedItem;let i=new FormData;i.append("payment_method_id",t.payment_method_id),i.append("meta",JSON.stringify(t.meta));var r=e.payments.editedIndex,s=api_url+"payments/update";e.$http.post(s,i).then(i=>{"success"==i.body.status&&Object.assign(e.payments.items[r],t),e.close(),e.loading=!1},t=>{e.loading=!1})},processOrder(e=1){var t=this,i=1===e?"approve":"reject",r=api_url+"orders/"+i+"/"+t.orders.editedItem.order_id;t.approve_loading=!0;var s=t.orders.editedItem;s.course_title=t.orders.editedItem.meta.hasOwnProperty("course")?t.orders.editedItem.meta.course:"",t.$http.post(r,s).then(i=>{t.approve_loading=!1,"success"==i.body.status&&(t.orders.editedItem.status=e,Object.assign(t.orders.items[t.orders.editedIndex],t.orders.editedItem),t.filterProcessingOrder(),t.rejectDialog=!1,t.dialogOrderPreview=!1)},e=>{})},getStatus(e){switch(parseInt(e)){case 0:return{color:"warning",name:"Procesando"};case 1:return{color:"success",name:"Aprobada"};case 2:return{color:"error",name:"Rechazada"}}}}});