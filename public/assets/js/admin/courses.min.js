moment.locale("ro");let vm=new Vue({vuetify:vuetify,el:"#app-container",data:{previewImage:"",course_search:"",category_search:"",loading:!1,table_loading:!1,dialog:!1,lesson_dialog:!1,dialogDelete:!1,categoryDialogDelete:!1,categoryDialog:!1,subCategoryDialogDelete:!1,subCategoryDialog:!1,valid:!1,validCategory:!1,validSubCategory:!1,birthdateDialog:!1,birthdate_modal:!1,zoomDateDialog:!1,zoomTimeDialog:!1,zoom_date_modal:!1,zoom_time_modal:!1,drawer:!0,modal:!1,selectedItem:4,validations:validations,percent_loading_active:!1,percent_loading:0,min_age:4,max_age:18,age_range:[4,18],customToolbar:[["bold","italic","underline"],[{list:"ordered"},{list:"bullet"}],[{align:""},{align:"center"},{align:"right"},{align:"justify"}]],curriculum:{loading:!1,add_loading:!1,add_lesson_loading:!1,add_quiz_loading:!1,update_section_loading:!1,update_lesson_loading:!1,update_lesson_meta_loading:!1,sections:[]},lessons:{loading:!1,types:[{text:"Clasa",value:"1"}],class_types:[{text:"Zoom",value:"zoom_meeting"}],item:{quizzes:[],meta:{class_type:"zoom_meeting",duration:"",description:"",zoom_agenda:"",zoom_duration:"",zoom_date:"",zoom_time:"",zoom_start_time:"",zoom_timezone:"Europe/Bucharest",video:void 0,poster:void 0}},itemMetaDefault:{class_type:"zoom_meeting",duration:"",description:"",zoom_agenda:"",zoom_duration:"",zoom_date:"",zoom_time:"",zoom_start_time:"",zoom_timezone:"Europe/Bucharest",video:void 0,poster:void 0},editedLessonIndex:-1,editedSectionIndex:-1},true_false:[{text:"Activ",value:"1"},{text:"Inactiv",value:"0"}],headers:[{text:"Data creării",align:"start",value:"published_at"},{text:"Titlul cursului",align:"start",value:"title"},{text:"Preț",value:"price"},{text:"Stare",value:"active"},{text:"Acțiuni",value:"actions",align:"center",sortable:!1}],courses:[],timezones:[],categories:{table_loading:!1,loading:!1,valid:!1,items:[],headers:[{text:"Denumirea categoriei",align:"start",value:"name"},{text:"Acțiuni",value:"actions",align:"center",sortable:!1}],editedItem:{name:""},editedIndex:-1},editedIndex:-1,editedItem:{course_id:void 0,featured_image:"",new_featured_image:new File([],""),title:"",slug:"",price:"",duration:"",category:"",category_id:"",active:"1",min_students:1,max_students:20,min_age:4,max_age:18,meta:{description:""}},defaultItem:{course_id:void 0,featured_image:"",new_featured_image:new File([],""),title:"",slug:"",price:"",duration:"",category:"",category_id:"",active:"1",min_students:1,max_students:20,min_age:4,max_age:18,meta:{description:""}}},computed:{formTitle(){return-1===this.editedIndex?"Adăugați un nou curs":"Editare curs"},categoryFormTitle(){return-1===this.categories.editedIndex?"Creați o categorie":"Editați categoria"}},watch:{dialog(e){e||this.close()},dialogDelete(e){e||this.closeDelete()},categoryDialog(e){e||this.closeCategory()},categoryDialogDelete(e){e||this.closeCategoryDelete()},age_range(){this.course.min_age=this.age_range[0],this.course.max_age=this.age_range[1]}},created(){window.onload=(()=>{check_google_user()}),this.initialize(),this.initializeCategories(),this.initializeTimezones()},mounted(){},methods:{initialize(){var e=api_url+"courses/get";this.table_loading=!0,this.$http.get(e).then(e=>{this.table_loading=!1,this.courses=e.body},e=>{})},initializeTimezones(){var e=this,t=domain+"/timezones.min.json";e.$http.get(t).then(t=>{e.timezones=t.body.timezone},e=>{})},initializeCategories(){var e=api_url+"categories/get";this.categories.table_loading=!0,this.$http.get(e).then(e=>{this.categories.table_loading=!1,this.categories.items=e.body},e=>{})},getCurriculum(){var e=api_url+"course-sections/get",t={course_id:this.editedItem.course_id};this.$http.post(e,t).then(e=>{this.curriculum.sections=e.body},e=>{})},checkSectionMove(){var e=this.curriculum.sections;e.forEach((e,t)=>{e.section_order=t})},checkLessonMove(e){var t=this.curriculum.sections[e].items;t.forEach((e,t)=>{e.lesson_order=t})},addSection(){var e=this,t=e.curriculum.sections.length,i=-1==t?1:t;t++;var s={section_name:"Secțiunea "+t,section_id:void 0,section_order:i,items:[],course_id:void 0};e.curriculum.sections.push(s)},addLesson(e,t){var i=this,s=i.curriculum.sections[e],a=s.items.indexOf(t),o=-1==a?0:a,d=s.items.length;d++;var r={lesson_name:"Clasa "+d,old_lesson_name:"Clasa "+a,lesson_type:"1",lesson_order:o,meta:Object.assign({},i.lessons.itemMetaDefault),quizzes:[],resources:[]};i.curriculum.sections[e].items.push(r)},updateLessonMeta(){var e=this,t=e.lessons.item;Object.assign(e.curriculum.sections[e.lessons.editedSectionIndex].items[e.lessons.editedLessonIndex].meta,t.meta),e.lesson_dialog=!1},openLessonDialog(e,t){var i=this;i.lessons.item=Object.assign({},t),i.lessons.editedLessonIndex=i.curriculum.sections[e].items.indexOf(t),i.lessons.editedSectionIndex=e,i.lessons.item.meta=t.hasOwnProperty("meta")?t.meta:i.lessons.itemMetaDefault,i.lessons.item.quizzes=t.hasOwnProperty("quizzes")?t.quizzes:[],i.lesson_dialog=!0},removeSection(e){var t=this,i=t.curriculum.sections.indexOf(e);t.curriculum.sections.splice(i,1)},removeLesson(e,t){var i=this,s=(i.curriculum.sections[e],i.curriculum.sections[e].items.indexOf(t));i.curriculum.sections[e].items.splice(s,1)},editItem(e){this.editedIndex=this.courses.indexOf(e),this.editedItem=Object.assign({},e),this.editedItem.new_featured_image=new File([],""),this.editedItem.meta.hasOwnProperty("description")||(this.editedItem.meta.description=""),this.getCurriculum(),this.dialog=!0},deleteItem(e){this.editedIndex=this.courses.indexOf(e),this.editedItem=Object.assign({},e),this.dialogDelete=!0},deleteItemConfirm(){var e=this.editedItem.course_id,t=api_url+"courses/delete";this.$http.post(t,{course_id:e}).then(e=>{this.courses.splice(this.editedIndex,1),this.closeDelete()},e=>{this.closeDelete()})},editCategoryItem(e){this.categories.editedIndex=this.categories.items.indexOf(e),this.categories.editedItem=Object.assign({},e),this.categoryDialog=!0},deleteCategoryItem(e){this.categories.editedIndex=this.categories.items.indexOf(e),this.categories.editedItem=Object.assign({},e),this.categoryDialogDelete=!0},deleteCategoryItemConfirm(){var e=this.categories.editedItem.category_id,t=api_url+"categories/delete";this.$http.post(t,{category_id:e}).then(e=>{"success"==e.body.status&&(this.categories.items.splice(this.categories.editedIndex,1),this.initialize()),this.closeCategoryDelete()},e=>{this.closeCategoryDelete()})},closeDelete(){this.dialogDelete=!1,this.$nextTick(()=>{this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1})},closeCategoryDelete(){this.categoryDialogDelete=!1,this.$nextTick(()=>{this.categories.editedItem=Object.assign({},{name:""}),this.categories.editedIndex=-1})},close(){this.dialog=!1,this.$nextTick(()=>{this.editedItem=Object.assign({},this.defaultItem),this.curriculum.sections=[],this.editedIndex=-1})},closeCategory(){this.categoryDialog=!1,this.$nextTick(()=>{this.categories.editedItem=Object.assign({},{name:""}),this.categories.editedIndex=-1})},closeSubCategory(){this.subCategoryDialog=!1,this.$nextTick(()=>{this.subcategories.editedItem=Object.assign({},{name:""}),this.subcategories.editedIndex=-1})},save(){var e=this;e.loading=!0;var t=Object.assign({},e.editedItem),i=e.editedIndex;t.section=JSON.stringify(e.curriculum.sections),t.meta=JSON.stringify(t.meta);let s=new FormData;for(var a in t)s.append(a,t[a]);if(i>-1){var o=api_url+"courses/update";e.$http.post(o,s).then(t=>{"success"==t.body.status?(e.editedItem.featured_image=t.body.data.featured_image,e.editedItem.slug=t.body.data.slug,Object.assign(e.courses[i],e.editedItem),e.loading=!1,e.close()):e.loading=!1},t=>{e.loading=!1})}else{o=api_url+"courses/create";e.$http.post(o,s).then(t=>{"success"==t.body.status?(e.editedItem.date=current_date,e.editedItem.course_id=t.body.data.course_id,e.editedItem.slug=t.body.data.slug,e.editedItem.featured_image=t.body.data.featured_image,e.courses.push(e.editedItem),e.close(),e.loading=!1):e.loading=!1},t=>{e.loading=!1})}},saveCategory(){var e=this;e.categories.loading=!0;var t=e.categories.editedItem,i=e.categories.editedIndex;if(i>-1){var s=api_url+"categories/update";e.$http.post(s,t).then(s=>{"success"==s.body.status&&Object.assign(e.categories.items[i],t),e.closeCategory(),e.categories.loading=!1},t=>{e.categories.loading=!1})}else{s=api_url+"categories/create";e.$http.post(s,t).then(i=>{"success"==i.body.status&&(t.category_id=i.body.data.category_id,e.categories.items.push(t)),e.categories.loading=!1,e.closeCategory()},t=>{e.categories.loading=!1,e.closeCategory()})}},prevImage(e){const t=e.target.files[0],i=new FileReader;i.readAsDataURL(t),i.onload=(e=>{this.editedItem.featured_image=t,this.previewImage=e.target.result,this.upload_button=!0})},validate(){this.$refs.form.validate()},formatDate:(e,t)=>moment(e).format(t)}});