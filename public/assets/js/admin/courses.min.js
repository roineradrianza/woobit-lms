moment.locale("es");let vm=new Vue({vuetify:vuetify,el:"#full-learning-container",data:{previewImage:"",loading:!1,table_loading:!1,dialog:!1,dialogDelete:!1,categoryDialogDelete:!1,categoryDialog:!1,subCategoryDialogDelete:!1,subCategoryDialog:!1,valid:!1,validCategory:!1,validSubCategory:!1,birthdateDialog:!1,birthdate_modal:!1,drawer:!0,modal:!1,selectedItem:4,validations:validations,levels:[{text:"Principiante",value:"principiante"},{text:"Intermedio",value:"intermedio"},{text:"Avanzado",value:"avanzado"}],true_false:[{text:"Activo",value:"1"},{text:"Inactivo",value:"0"}],headers:[{text:"Fecha de publicación",align:"start",value:"published_at"},{text:"Título del curso",align:"start",value:"title"},{text:"Nivel",value:"level"},{text:"Activo",value:"active"},{text:"Acciones",value:"actions",align:"center",sortable:!1}],courses:[],categories:{table_loading:!1,loading:!1,valid:!1,items:[],headers:[{text:"Nombre",align:"start",value:"name"},{text:"Acciones",value:"actions",align:"center",sortable:!1}],editedItem:{name:""},editedIndex:-1},subcategories:{table_loading:!1,loading:!1,valid:!1,items:[],filtered_items:[],headers:[{text:"Nombre",align:"start",value:"name"},{text:"Acciones",value:"actions",align:"center",sortable:!1}],editedItem:{name:""},editedIndex:-1},editedIndex:-1,editedItem:{},defaultItem:{featured_image:"",title:"",slug:"",price:0,duration:"",category_id:null,subcategory_id:null,duration:"",level:"principiante",user_id:"",active:"0",platform_owner:"0",published_at:current_date,meta:{}}},computed:{formTitle(){return-1===this.editedIndex?"Crear curso":"Editar curso"},categoryFormTitle(){return-1===this.categories.editedIndex?"Crear categoría":"Editar categoría"},subCategoryFormTitle(){return-1===this.categories.editedIndex?"Crear subcategoría":"Editar subcategoría"}},watch:{dialog(e){e||this.close()},dialogDelete(e){e||this.closeDelete()},categoryDialog(e){e||this.closeCategory()},categoryDialogDelete(e){e||this.closeCategoryDelete()}},created(){window.onload=(()=>{check_google_user()}),this.editedItem=this.defaultItem,this.initialize(),this.initializeCategories(),this.initializeSubCategories()},mounted(){},methods:{initialize(){var e=api_url+"courses/get";this.table_loading=!0,this.$http.get(e).then(e=>{this.table_loading=!1,this.courses=e.body},e=>{})},initializeCategories(){var e=api_url+"categories/get";this.categories.table_loading=!0,this.$http.get(e).then(e=>{this.categories.table_loading=!1,this.categories.items=e.body},e=>{})},initializeSubCategories(){var e=api_url+"subcategories/get";this.subcategories.table_loading=!0,this.$http.get(e).then(e=>{this.subcategories.table_loading=!1,this.subcategories.items=e.body,this.subcategories.filtered_items=e.body},e=>{})},editItem(e){this.editedIndex=this.courses.indexOf(e),this.editedItem=Object.assign({},e),this.editedItem.meta.hasOwnProperty("description")||(this.editedItem.meta.description=""),this.dialog=!0},deleteItem(e){this.editedIndex=this.courses.indexOf(e),this.editedItem=Object.assign({},e),this.dialogDelete=!0},deleteItemConfirm(){var e=this.editedItem.course_id,t=api_url+"courses/delete";this.$http.post(t,{course_id:e}).then(e=>{this.courses.splice(this.editedIndex,1),this.closeDelete()},e=>{this.closeDelete()})},editCategoryItem(e){this.categories.editedIndex=this.categories.items.indexOf(e),this.categories.editedItem=Object.assign({},e),this.categoryDialog=!0},deleteCategoryItem(e){this.categories.editedIndex=this.categories.items.indexOf(e),this.categories.editedItem=Object.assign({},e),this.categoryDialogDelete=!0},deleteCategoryItemConfirm(){var e=this.categories.editedItem.category_id,t=api_url+"categories/delete";this.$http.post(t,{category_id:e}).then(e=>{"success"==e.body.status&&(this.categories.items.splice(this.categories.editedIndex,1),this.initialize()),this.closeCategoryDelete()},e=>{this.closeCategoryDelete()})},editSubCategoryItem(e){this.subcategories.editedIndex=this.subcategories.items.indexOf(e),this.subcategories.editedItem=Object.assign({},e),this.subCategoryDialog=!0},deleteSubCategoryItem(e){this.subcategories.editedIndex=this.subcategories.items.indexOf(e),this.subcategories.editedItem=Object.assign({},e),this.subCategoryDialogDelete=!0},deleteSubCategoryItemConfirm(){var e=this.subcategories.editedItem.subcategory_id,t=api_url+"subcategories/delete";this.$http.post(t,{subcategory_id:e}).then(e=>{"success"==e.body.status&&(this.subcategories.items.splice(this.subcategories.editedIndex,1),this.initialize()),this.closeSubCategoryDelete()},e=>{this.closeSubCategoryDelete()})},closeDelete(){this.dialogDelete=!1,this.$nextTick(()=>{this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1})},closeCategoryDelete(){this.categoryDialogDelete=!1,this.$nextTick(()=>{this.categories.editedItem=Object.assign({},{name:""}),this.categories.editedIndex=-1})},closeSubCategoryDelete(){this.subCategoryDialogDelete=!1,this.$nextTick(()=>{this.subcategories.editedItem=Object.assign({},{name:""}),this.subcategories.editedIndex=-1})},close(){this.dialog=!1,this.$nextTick(()=>{this.editedItem=Object.assign({},this.defaultItem),this.editedItem.featured_image="",this.previewImage="",this.editedItem.meta.description="",this.editedIndex=-1})},closeCategory(){this.categoryDialog=!1,this.$nextTick(()=>{this.categories.editedItem=Object.assign({},{name:""}),this.categories.editedIndex=-1})},closeSubCategory(){this.subCategoryDialog=!1,this.$nextTick(()=>{this.subcategories.editedItem=Object.assign({},{name:""}),this.subcategories.editedIndex=-1})},save(){var e=this;e.loading=!0;var t=e.editedItem;let i=new FormData;i.append("featured_image",t.featured_image),i.append("title",t.title),i.append("duration",t.duration),i.append("price",parseFloat(t.price)),i.append("category_id",t.category_id),i.append("subcategory_id",t.subcategory_id),i.append("level",t.level),i.append("active",t.active),i.append("platform_owner",t.platform_owner),i.append("meta",JSON.stringify(t.meta));var a=e.editedIndex;if(a>-1){i.append("user_id",t.user_id),i.append("course_id",t.course_id);var s=api_url+"courses/update";e.$http.post(s,i).then(i=>{"success"==i.body.status&&(t.featured_image=i.body.data.featured_image,t.slug=i.body.data.slug,Object.assign(e.courses[a],t)),e.close(),e.loading=!1},t=>{e.loading=!1})}else{s=api_url+"courses/create";e.$http.post(s,i).then(i=>{t.date=current_date,"success"==i.body.status&&(t.course_id=i.body.data.course_id,t.slug=i.body.data.slug,t.featured_image=i.body.data.featured_image,e.courses.push(t)),e.close(),e.loading=!1},t=>{e.loading=!1,e.close()})}},saveCategory(){var e=this;e.categories.loading=!0;var t=e.categories.editedItem,i=e.categories.editedIndex;if(i>-1){var a=api_url+"categories/update";e.$http.post(a,t).then(a=>{"success"==a.body.status&&Object.assign(e.categories.items[i],t),e.closeCategory(),e.categories.loading=!1},t=>{e.categories.loading=!1})}else{a=api_url+"categories/create";e.$http.post(a,t).then(i=>{"success"==i.body.status&&(t.category_id=i.body.data.category_id,e.categories.items.push(t)),e.categories.loading=!1,e.closeCategory()},t=>{e.categories.loading=!1,e.closeCategory()})}},saveSubCategory(){var e=this;e.subcategories.loading=!0;var t=e.subcategories.editedItem,i=e.subcategories.editedIndex;if(i>-1){var a=api_url+"subcategories/update";e.$http.post(a,t).then(a=>{"success"==a.body.status&&Object.assign(e.subcategories.items[i],t),e.closeSubCategory(),e.subcategories.loading=!1},t=>{e.subcategories.loading=!1})}else{a=api_url+"subcategories/create";e.$http.post(a,t).then(i=>{"success"==i.body.status&&(t.subcategory_id=i.body.data.subcategory_id,e.subcategories.items.push(t)),e.subcategories.loading=!1,e.closeSubCategory()},t=>{e.subcategories.loading=!1,e.closeSubCategory()})}},prevImage(e){const t=e.target.files[0],i=new FileReader;i.readAsDataURL(t),i.onload=(e=>{this.editedItem.featured_image=t,this.previewImage=e.target.result,this.upload_button=!0})},validate(){this.$refs.form.validate()},formatDate:(e,t)=>moment(e).format(t),filterSubcategories(){var e=this;e.$refs.subcategory_select.reset(),e.editedItem.subcategory_id="";var t=e.subcategories.items.filter(t=>t.category_id==e.editedItem.category_id);e.subcategories.filtered_items=t}}});