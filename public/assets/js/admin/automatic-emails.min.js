let vm=new Vue({vuetify:vuetify,el:"#app-container",data:{alert:!1,loading:!1,courses_loading:!1,students_loading:!1,coupons_table_loading:!1,send_loading:!1,dialog:!1,valid:!1,dialogDelete:!1,modal:!1,drawer:!0,openList:!1,emailFieldActivate:!1,selectedItem:7,optionSelected:-1,userOptionSelected:-1,alert_message:"",alert_type:"",new_email:"",userRolOptionSelected:"",studentsSelected:[],course:{},email:{title:"",content:"",attachment:void 0},user_xlsx:void 0,customToolbar:[[{header:[!1,1,2,3,4,5,6]}],["bold","italic","underline"],[{list:"ordered"},{list:"bullet"}],["link","code-block","strike"]],coupon_selected:[],email_options:[{text:"Cupones de descuento autogenerados",value:0},{text:"Correo personalizado",value:1},{text:"Enviar certificados",value:2}],user_options:[{text:"Selección por rol",value:0},{text:"Selección personalizada",value:1},{text:"Archivo de excel con correos electrónicos",value:2}],rol_options:[{text:"Estudiante",value:"student"},{text:"Estudiante de medicina",value:"medicine_student"},{text:"Profesor de medicina",value:"medicine_teacher"}],courses:[],students:[],students_list:[],students_excel:[],headers:[{text:"Nombre del cupón",align:"start",value:"coupon_name"},{text:"Rol del usuario",value:"student_rol"},{text:"Descuento",value:"discount"}],coupons:[],editedIndex:-1,editedItem:{},defaultItem:{}},computed:{formTitle(){return-1===this.editedIndex?"Crear cupón":"Modificar cupón"}},watch:{dialog(e){e||this.close()},dialogDelete(e){e||this.closeDelete()},optionSelected(e){this.alert=!1,this.studentsSelected=[],this.students_excel=[],""!=this.userRolOptionSelected&&this.filterByRol()},userOptionSelected(){this.students=this.students_list},coupon_selected(e){this.openList=e.length>0},userRolOptionSelected(e){this.filterByRol()},studentsSelected(e){this.emailFieldActivate=e.length>0},students_excel(e){this.emailFieldActivate=e.length>0}},created(){check_google_user(),this.editedItem=this.defaultItem,this.loadCourses(),this.loadStudents()},mounted(){},methods:{loadCoupons(){var e=api_url+"coupons/get-by-course/"+this.course.course_id;this.coupons_table_loading=!0,this.coupon_selected=[],this.$http.get(e).then(e=>{this.coupons_table_loading=!1,this.coupons=e.body},e=>{})},loadCourses(){var e=api_url+"courses/get-courses";this.courses_loading=!0,this.$http.get(e).then(e=>{this.courses_loading=!1,e.body.length>0&&(this.courses=e.body)},e=>{})},loadStudents(){var e=api_url+"members/get-by-members";this.students_loading=!0,this.$http.get(e).then(e=>{this.students_loading=!1,e.body.length>0&&(this.students=e.body,this.students_list=e.body)},e=>{})},sendCoupons(){var e=this;e.send_loading=!0,e.alert=!1;var t={course:e.course,coupon:e.coupon_selected[0],title:e.email.title,content:e.email.content,attachment:e.email.attachment},s={course:e.course,coupon:e.coupon_selected[0],title:e.email.title,content:e.email.content,attachment:e.email.attachment};2==e.userOptionSelected?s.students=e.students_excel:s.students=e.studentsSelected;t=new FormData;if(t.append("course",JSON.stringify(s.course)),t.append("students",JSON.stringify(s.students)),t.append("coupon",JSON.stringify(s.coupon)),t.append("title",s.title),t.append("content",s.content),t.append("attachment",s.attachment),2==e.userOptionSelected){t.students=e.students_excel;var n=api_url+"emails/send-coupons-codes-and-register"}else{t.students=e.studentsSelected;n=api_url+"emails/send-coupons-codes"}e.$http.post(n,t).then(t=>{e.alert=!0,e.alert_message=t.body.message,e.alert_type=t.body.status,t.body.data.errors.length>0&&(e.alert_message+="<p>Se encontraron los siguientes problemas:</p>",t.body.data.errors.forEach(t=>{e.alert_message+=`<p>${t}</p>`}),e.alert_type="warning"),e.send_loading=!1},t=>{e.send_loading=!1})},sendCustomEmail(){var e=this;e.send_loading=!0,e.alert=!1;var t={course:e.course,students:[],title:e.email.title,content:e.email.content,attachment:e.email.attachment};2==e.userOptionSelected?t.students=e.students_excel:t.students=e.studentsSelected;var s=new FormData;s.append("course",JSON.stringify(t.course)),s.append("students",JSON.stringify(t.students)),s.append("title",t.title),s.append("content",t.content),s.append("attachment",t.attachment);var n=api_url+"emails/send-custom-email";e.$http.post(n,s).then(t=>{e.alert=!0,e.alert_message=t.body.message,e.alert_type=t.body.status,t.body.data.errors.length>0&&(e.alert_message+="<p>Se encontraron los siguientes problemas:</p>",t.body.data.errors.forEach(t=>{e.alert_message+=`<p>${t}</p>`}),e.alert_type="warning"),e.send_loading=!1},t=>{e.send_loading=!1})},sendCertifiedEmail(){var e=this;e.send_loading=!0,e.alert=!1;var t=api_url+"emails/send-certifieds",s={course:e.course,title:e.email.title,content:e.email.content,attachment:e.email.attachment};2==e.userOptionSelected?s.students=e.students_excel:s.students=e.studentsSelected;var n=new FormData;n.append("course",JSON.stringify(s.course)),n.append("title",s.title),n.append("content",s.content),n.append("students",JSON.stringify(s.students)),n.append("attachment",s.attachment),e.$http.post(t,n).then(t=>{e.alert=!0,e.alert_message=t.body.message,e.alert_type=t.body.status,t.body.data.errors.length>0&&(e.alert_message+="<p>Se encontraron los siguientes problemas:</p>",t.body.data.errors.forEach(t=>{e.alert_message+=`<p>${t}</p>`}),e.alert_type="warning"),e.send_loading=!1},t=>{e.send_loading=!1})},filterByRol(){var e=this;if(""!=e.userRolOptionSelected){var t=e.students.filter(t=>t.meta.student_type==e.userRolOptionSelected);e.studentsSelected=t}},displayItem:e=>e.hasOwnProperty("first_name")||e.hasOwnProperty("last_name")?e.first_name+" "+e.last_name:e.email,addEmail(){var e=this;e.students.push({email:e.new_email}),e.studentsSelected.push({email:e.new_email})},readStudentsXLSX(e){var t=this;const s=new FileReader;"undefined"!==t.user_xlsx&&(s.readAsBinaryString(t.user_xlsx),s.onload=(e=>{const s=["full_name","email"];var n=e.target.result,a=XLSX.read(n,{type:"binary"}),l=a.SheetNames[0],o=XLSX.utils.sheet_to_json(a.Sheets[l],{header:s});t.students_excel=o.splice(1,o.length)}))},validate(){this.$refs.form.validate()}}});