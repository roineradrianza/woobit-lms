const splitted_domain=window.location.href.split("/"),course_id=splitted_domain[5];let vm=new Vue({vuetify:vuetify,el:"#app-container",data:{tab:null,nav_tab:null,alert:!1,dialog:!1,reminder:!1,loading:!1,page_loading:!1,image_loading:!1,general_loading:!1,setup_loading:!1,image_certified_by_loading:!1,percent_loading_active:!1,dialog:!1,valid:!1,dialogDelete:!1,birthdateDialog:!1,zoomDateDialog:!1,zoomTimeDialog:!1,streamingTimeDialog:!1,streamingDateDialog:!1,birthdate_modal:!1,zoom_date_modal:!1,zoom_time_modal:!1,streaming_time_modal:!1,streaming_date_modal:!1,drawer:!0,modal:!1,alert_message:"",alert_type:"",previewImage:"",previewCertifiedBy:"",currentImage:"",currentCertifiedBy:"",selectedItem:4,percent_loading:0,validations:validations,featured_image:"",certified_by:"",faq:{add_loading:!1,items:[],customToolbar:[["bold","italic","underline"],[{list:"ordered"},{list:"bullet"}]]},curriculum:{loading:!1,add_loading:!1,add_lesson_loading:!1,add_quiz_loading:!1,update_section_loading:!1,update_lesson_loading:!1,update_lesson_meta_loading:!1,sections:[],customToolbar:[["bold","italic","underline"],[{list:"ordered"},{list:"bullet"}]]},notifications:[],levels:[{text:"Principiante",value:"principiante"},{text:"Intermedio",value:"intermedio"},{text:"Avanzado",value:"avanzado"}],true_false:[{text:"Activo",value:"1"},{text:"Inactivo",value:"0"}],lessons:{loading:!1,quiz_options:[{text:"Selecci칩n simple",value:"1"},{text:"Verdadero o Falso",value:"2"},{text:"Completaci칩n",value:"3"}],types:[{text:"Clase",value:"1"},{text:"Quiz",value:"2"},{text:"Actividades",value:"3"},{text:"Recursos",value:"4"}],class_types:[{text:"Video",value:"video"},{text:"Zoom",value:"zoom_meeting"},{text:"Streaming",value:"streaming"}],item:{quizzes:[],meta:{class_type:"",duration:"",description:"",zoom_agenda:"",zoom_duration:"",zoom_date:"",zoom_time:"",zoom_start_time:"",zoom_timezone:"",video:void 0,poster:void 0}},itemMetaDefault:{class_type:"",duration:"",description:"",zoom_description:"",video:void 0,poster:void 0},editedLessonIndex:-1,editedSectionIndex:-1},categories:[],subcategories:[],filtered_subcategories:[],timezones:[],course:{featured_image:"",title:"",slug:"",price:"",duration:"",category:"",level:"",user_id:"",active:0,course_id:course_id,meta:{description:"Lorem ipsum dolor sit amet consectetur adipisicing elit. Ipsa sunt aspernatur eveniet cupiditate soluta architecto ducimus, fuga. Quo voluptatem eligendi, harum eius nostrum veniam minima iste illo explicabo adipisci, voluptate!",certified_by:"",instructors:[]}},instructors:{loading:!1,instructors_loading:!1,add_loading:!1,searched:!1,alert:!1,alert_type:"",alert_message:"",user_selected:"",items:[],users:[],username_search:""}},computed:{},watch:{dialog(e){e||this.close()},dialogDelete(e){e||this.closeDelete()}},created(){window.onload=(()=>{check_google_user()}),this.editedItem=this.defaultItem,this.initialize(),this.initializeCategories(),this.initializeSubCategories(),this.initializeTimezones()},mounted(){this.reminder=!0},methods:{initialize(){var e=api_url+"courses/get/"+this.course.course_id;this.page_loading=!0,this.$http.get(e).then(e=>{this.page_loading=!1,this.course=e.body[0],this.getInstructors(),this.course.meta.hasOwnProperty("certified_by")&&(this.currentCertifiedBy=this.course.meta.certified_by,this.previewCertifiedBy=this.course.meta.certified_by),this.course.meta.hasOwnProperty("faq")&&(this.course.meta.faq=JSON.parse(this.course.meta.faq),this.faq.items=this.course.meta.faq),this.currentImage=this.course.featured_image,this.previewImage=this.currentImage,this.getSections()},e=>{})},initializeCategories(){var e=api_url+"categories/get";this.categories_loading=!0,this.$http.get(e).then(e=>{this.categories_loading=!1,this.categories=e.body},e=>{})},initializeSubCategories(){var e=api_url+"subcategories/get";this.subcategories_loading=!0,this.$http.get(e).then(e=>{this.subcategories_loading=!1,this.subcategories=e.body,this.filtered_subcategories=e.body},e=>{})},initializeTimezones(){var e=this,t=domain+"/timezones.min.json";e.$http.get(t).then(t=>{e.timezones=t.body.timezone},e=>{})},getInstructors(){var e=this,t=api_url+"courses/get-instructors/"+e.course.course_id;e.$http.get(t).then(t=>{e.instructors.items=t.body},e=>{})},getSections(){var e=this,t={course_id:e.course.course_id},s=api_url+"course-sections/get";e.$http.post(s,t).then(t=>{t.body!={}&&t.body.forEach((e,s)=>{t.body[s].items.length>0&&t.body[s].items.forEach((e,t)=>{Array.isArray(e.meta)&&(e.meta={}),e.resources.forEach((e,t)=>{e.loading=!1,e.percent_loading_active=!1,e.percent_loading=0})})}),e.curriculum.sections=t.body},e=>{})},searchUser(){var e=this,t=api_url+"members/search-user/"+e.instructors.username_search;e.instructors.alert=!1,e.instructors.searched=!1,e.instructors.user_selected="",e.instructors.loading=!0,e.$http.get(t).then(t=>{e.instructors.loading=!1,e.instructors.searched=!0,e.instructors.users=t.body},e=>{})},saveGeneral(){var e=this;e.general_loading=!0;var t=e.course;let s=new FormData;s.append("featured_image",t.featured_image),s.append("title",t.title),s.append("duration",t.duration),s.append("price",parseFloat(t.price)),s.append("level",t.level),s.append("active",t.active),s.append("meta",JSON.stringify(t.meta)),s.append("user_id",t.user_id),s.append("platform_owner",t.platform_owner),s.append("course_id",t.course_id),s.append("category_id",t.category_id),s.append("subcategory_id",t.subcategory_id);var i=api_url+"courses/update";e.$http.post(i,s).then(t=>{"success"==t.body.status&&(e.course.slug=t.body.data.slug),e.general_loading=!1},t=>{e.general_loading=!1})},saveSetup(){var e=this;e.setup_loading=!0;var t=e.course;let s=new FormData;var i={zoom_jwt:t.meta.zoom_jwt,zoom_host:t.meta.zoom_host};s.append("meta",JSON.stringify(i)),s.append("course_id",t.course_id);var a=api_url+"courses/update-meta";e.$http.post(a,s).then(t=>{t.body.status,e.setup_loading=!1},t=>{e.setup_loading=!1})},saveInstructor(){var e=this;if(e.instructors.alert=!1,e.checkInstructor(e.instructors.user_selected))e.instructors.alert=!0,e.instructors.alert_message="El usuario ya se encuentra a침adido como profesor",e.instructors.alert_type="warning";else{e.instructors.add_loading=!0;var t=api_url+"courses/add-instructor",s={course_id:e.course.course_id,user_id:e.instructors.user_selected.user_id};e.$http.post(t,s).then(t=>{"success"==t.body.status&&e.instructors.items.push(e.instructors.user_selected),e.instructors.add_loading=!1},t=>{e.instructors.add_loading=!1})}},saveFAQ(){var e=this;e.faq.add_loading=!0;var t=api_url+"courses/update-meta";let s=new FormData;s.append("course_id",e.course.course_id),s.append("meta",JSON.stringify({faq:e.faq.items})),e.$http.post(t,s).then(t=>{e.faq.add_loading=!1},t=>{e.faq.add_loading=!1})},checkInstructor(e){var t=this,s=t.instructors.items.filter(t=>t.user_id==e.user_id);return s.length>0},removeInstructor(e){var t=this;t.instructors.add_loading=!0;var s=api_url+"courses/remove-instructor",i=t.instructors.items.indexOf(e),a={course_id:t.course.course_id,user_id:e.user_id};t.$http.post(s,a).then(e=>{"success"==e.body.status&&t.instructors.items.splice(i,1),t.instructors.add_loading=!1},e=>{t.instructors.add_loading=!1})},prevImage(e){const t=e.target.files[0],s=new FileReader;s.readAsDataURL(t),s.onload=(e=>{this.course.featured_image=t,this.previewImage=e.target.result})},prevCertifiedByImage(e){const t=e.target.files[0],s=new FileReader;s.readAsDataURL(t),s.onload=(e=>{this.course.meta.certified_by=t,this.previewCertifiedBy=e.target.result})},resetImage(){var e=this;e.previewImage=e.currentImage,e.course.featured_image=e.currentImage},resetCertifiedByImage(){var e=this;""!=e.currentCertifiedBy?(e.previewCertifiedBy=e.currentCertifiedBy,e.course.meta.certified_by=e.currentCertifiedBy):e.previewCertifiedBy=""},saveFeaturedImage(){var e=this;e.image_loading=!0;var t=e.course;let s=new FormData;s.append("featured_image",t.featured_image),s.append("slug",t.slug),s.append("course_id",t.course_id);var i=api_url+"courses/update-cover";e.$http.post(i,s).then(t=>{"success"==t.body.status&&(e.currentImage=t.body.data.featured_image,e.course.featured_image=t.body.data.featured_image),e.image_loading=!1},t=>{e.image_loading=!1})},saveCertifiedByImage(){var e=this;e.image_certified_by_loading=!0;var t=e.course;let s=new FormData;s.append("certified_by_image",t.meta.certified_by),s.append("slug",t.slug),s.append("course_id",t.course_id);var i=api_url+"courses/update-certified-by";e.$http.post(i,s).then(t=>{"success"==t.body.status&&(e.currentCertifiedBy=t.body.data.certified_by_image,e.course.meta.certified_by=t.body.data.certified_by_image),e.image_certified_by_loading=!1},t=>{e.image_certified_by_loading=!1})},filterSubcategories(){var e=this;e.$refs.subcategory_select.reset(),e.course.subcategory_id="";var t=e.subcategories.filter(t=>t.category_id==e.course.category_id);e.filtered_subcategories=t},getCategory(e){var t=this,s=t.categories.filter(t=>t.category_id==e);if(s.length>0)return s[0].name},getSubCategory(e){var t=this,s=t.subcategories.filter(t=>t.subcategory_id==e);if(s.length>0)return" / "+s[0].name},addFAQ(){var e=this,t=e.faq.items.length;t++,e.faq.items.push({name:"",id:t,text:""})},addSection(){var e=this;e.curriculum.add_loading=!0;var t=e.curriculum.sections.length,s=-1==t?0:t;t++;var i={section_name:"Secci칩n "+t,section_id:t,section_order:s,items:[],course_id:e.course.course_id},a=api_url+"course-sections/create";e.$http.post(a,i).then(t=>{"success"==t.body.status&&(i.section_id=t.body.data.section_id,i.old_section_name=i.section_name,i.old_section_order=i.section_order,e.curriculum.sections.push(i)),e.curriculum.add_loading=!1},t=>{e.curriculum.add_loading=!1})},updateSection(e){var t=this;t.curriculum.update_section_loading=!0;var s=t.curriculum.sections.indexOf(e);e.course_id=t.course.course_id,e.section_order=s;var i=api_url+"course-sections/update";t.$http.post(i,e).then(i=>{"success"==i.body.status&&(e.old_section_order=e.section_order,e.old_section_name=e.section_name,Object.assign(t.curriculum.sections[s],e)),t.curriculum.update_section_loading=!1},e=>{t.curriculum.update_section_loading=!1})},addLesson(e,t){var s=this;s.curriculum.add_lesson_loading=!0;var i=s.curriculum.sections[e],a=i.items.indexOf(t),o=-1==a?0:a,r=i.items.length;r++;var n={lesson_name:"Clase "+r,old_lesson_name:"Clase "+r,lesson_type:1,lesson_order:o,meta:{},quizzes:[],resources:[],section_id:i.section_id},d=api_url+"course-lessons/create";s.$http.post(d,n).then(t=>{"success"==t.body.status&&(n.lesson_id=t.body.data.lesson_id,n.old_lesson_order=o,s.curriculum.sections[e].items.push(n)),s.curriculum.add_lesson_loading=!1},e=>{s.curriculum.add_lesson_loading=!1})},addQuestion(){var e=this;e.curriculum.add_quiz_loading=!0;var t=e.curriculum.sections[e.lessons.editedSectionIndex].items[e.lessons.editedLessonIndex],s=e.lessons.item.hasOwnProperty("quizzes")?e.lessons.item.quizzes.length+1:1,i={question_name:"Pregunta "+s,old_question_name:"Pregunta "+s,question_type:"1",score:1,question_answers:[],correct_answer:"",lesson_id:t.lesson_id},a=api_url+"lesson-quizzes/create";e.$http.post(a,{lesson:t,quiz:i}).then(s=>{"success"==s.body.status&&(e.curriculum.add_quiz_loading=!1,i.question_id=s.body.data.question_id,e.lessons.item.hasOwnProperty("quizzes")?e.lessons.item.quizzes.push(i):e.lessons.item.quizzes=[i],t.quizzes=Object.assign({},e.lessons.item.quizzes))},t=>{e.curriculum.add_quiz_loading=!1})},addQuestionAnswer(e){var t=e.question_answers.length+1,s="Respuesta "+t;e.question_answers.push({answer:s}),e.question_name+=" "},updateLessonMeta(){var e=this;e.curriculum.update_lesson_meta_loading=!0;var t=e.lessons.item;if(1==t.lesson_type){var s=new FormData,i=api_url+"course-lessons/update-class-lesson-meta/";s.append("course_id",e.course.course_id),s.append("lesson_id",t.lesson_id),s.append("class_type",t.meta.class_type),s.append("send_publish_email",t.meta.send_publish_email),s.append("description",t.meta.description),s.append("duration",t.meta.duration),"video"==t.meta.class_type?(s.append("poster",t.meta.poster),s.append("video",t.meta.video)):"zoom_meeting"==t.meta.class_type?(s.append("zoom_topic",t.lesson_name),t.meta.hasOwnProperty("zoom_id")&&s.append("meeting_id",t.meta.zoom_id),s.append("zoom_topic",t.lesson_name),s.append("zoom_jwt",e.course.meta.zoom_jwt),s.append("zoom_host",e.course.meta.zoom_host),s.append("zoom_duration",t.meta.zoom_duration),s.append("zoom_date",t.meta.zoom_date),s.append("zoom_time",t.meta.zoom_time),s.append("zoom_timezone",t.meta.zoom_timezone),s.append("zoom_start_time",moment(t.meta.zoom_date+" "+t.meta.zoom_time).format()),s.append("zoom_agenda",t.meta.zoom_agenda)):"streaming"==t.meta.class_type&&(s.append("streaming_date",t.meta.streaming_date),s.append("streaming_time",t.meta.streaming_time),s.append("streaming_id",t.meta.streaming_id),s.append("streaming_timezone",t.meta.streaming_timezone))}else if(2==t.lesson_type)s={lesson:t,course:{course_id:e.course.course_id,title:e.course.title,slug:e.course.slug}},i=api_url+"course-lessons/update-quiz-lesson-meta/";e.$http.post(i,s,{progress(t){t.lengthComputable&&(e.percent_loading_active=!0,e.percent_loading=t.loaded/t.total*100)}}).then(s=>{e.percent_loading_active=!1,e.curriculum.update_lesson_meta_loading=!1,e.alert=!0,e.alert_type=s.body.status,e.alert_message=s.body.message,"success"==s.body.status&&("video"==t.meta.class_type?(t.meta.video_url=s.body.data.hasOwnProperty("video_url")?s.body.data.video_url:t.meta.video_url,t.meta.poster_url=s.body.data.hasOwnProperty("poster_url")?s.body.data.poster_url:t.meta.video_url):"zoom_meeting"!=t.meta.class_type||t.meta.hasOwnProperty("zoom_id")||(t.meta.zoom_id=s.body.data.id,t.meta.zoom_url=s.body.data.join_url),Object.assign(e.curriculum.sections[e.lessons.editedSectionIndex].items[e.lessons.editedLessonIndex].meta,t.meta))},t=>{e.percent_loading_active=!1,e.curriculum.update_lesson_meta_loading=!1})},updateResource(e,t){var s=this,i=api_url+"media/create",a=new FormData;e.loading=!0,a.append("course_id",s.course.course_id),a.append("lesson_id",s.lessons.item.lesson_id),a.append("preview_only",e.preview_only),a.append("resource_name",e.name),a.append("media",e.file),e.hasOwnProperty("media_id")&&(a.append("media_id",e.media_id),a.append("url",e.url),i=api_url+"media/update"),s.$http.post(i,a,{progress(t){t.lengthComputable&&(e.percent_loading_active=!0,e.percent_loading=t.loaded/t.total*100)}}).then(t=>{s.curriculum.update_lesson_meta_loading=!1,"success"==t.body.status&&(e.hasOwnProperty("media_id")||(e.media_id=t.body.data.media_id),e.url=t.body.data.url),e.loading=!1,e.percent_loading_active=!1},t=>{e.percent_loading_active=!1,e.loading=!1})},updateLesson(e,t){var s=this;s.curriculum.update_lesson_loading=!0;var i=s.curriculum.sections[e],a=i.items.indexOf(t),o=-1==a?0:a;t.section_id=i.section_id,t.lesson_order=o;var r=api_url+"course-lessons/update";s.$http.post(r,t).then(i=>{"success"==i.body.status&&(t.old_lesson_order=t.lesson_order,t.old_lesson_name=t.lesson_name,Object.assign(s.curriculum.sections[e].items[o],t)),s.curriculum.update_lesson_loading=!1},e=>{s.curriculum.update_lesson_loading=!1})},updateQuestion(e){var t=this;t.curriculum.update_quiz_loading=!0;var s=api_url+"lesson-quizzes/update";t.$http.post(s,e).then(s=>{"success"==s.body.status&&(e.old_question_name=e.question_name),t.curriculum.update_quiz_loading=!1},e=>{t.curriculum.update_quiz_loading=!1})},openLessonDialog(e,t){var s=this;s.lessons.item=Object.assign({},t),s.lessons.editedLessonIndex=s.curriculum.sections[e].items.indexOf(t),s.lessons.editedSectionIndex=e,s.lessons.item.meta=t.hasOwnProperty("meta")?t.meta:s.lessons.itemMetaDefault,s.lessons.item.quizzes=t.hasOwnProperty("quizzes")?t.quizzes:[],s.dialog=!0},removeFAQ(e){var t=this,s=t.faq.items.indexOf(e);t.faq.items.splice(s,1)},removeSection(e){var t=this;t.curriculum.loading=!0;var s=t.curriculum.sections.indexOf(e),i=api_url+"course-sections/delete";data={course_id:t.course.course_id,section_id:e.section_id},t.$http.post(i,data).then(e=>{"success"==e.body.status&&t.curriculum.sections.splice(s,1),t.curriculum.loading=!1},e=>{t.curriculum.loading=!1})},removeLesson(e,t){var s=this;s.curriculum.loading=!0;var i=s.curriculum.sections[e],a=s.curriculum.sections[e].items.indexOf(t),o=api_url+"course-lessons/delete";data={section_id:i.section_id,lesson_id:t.lesson_id},s.$http.post(o,data).then(t=>{"success"==t.body.status&&s.curriculum.sections[e].items.splice(a,1),s.curriculum.loading=!1},e=>{s.curriculum.loading=!1})},removeQuiz(e,t){var s=this,i=api_url+"lesson-quizzes/delete";data={lesson_id:e.lesson_id,question_id:e.question_id},s.$http.post(i,data).then(e=>{"success"==e.body.status&&s.lessons.item.quizzes.splice(t,1)},e=>{})},removeResource(e,t){var s=this;if(e.hasOwnProperty("media_id")){var i=api_url+"media/delete";s.$http.post(i,e).then(e=>{"success"==e.body.status&&s.lessons.item.resources.splice(t,1)},e=>{})}else s.lessons.item.resources.splice(t,1)},removeQuestionAnswer(e,t){e.question_answers.splice(t,1),e.old_question_name+=" "},formatText(e){var t=e.split("").filter(e=>e.charCodeAt()>0).join("");return t},checkLessonNames(e){var t=e.old_lesson_name,s=e.lesson_name;return s==t},checkQuizNames(e){var t=e.old_question_name,s=e.question_name;return s==t},checkQuizType(e){"2"==e.question_type?(e.question_answers=[{answer:"Verdadero"},{answer:"Falso"}],e.correct_answer="Falso"):"3"==e.question_type&&(e.question_answers=[{answer:"",missing_words:""}])},matchWords(e){var t=e.answer,s=/\[([^\]]+)]/g,i="[",a="]",o=null!=t.match(s)?t.match(s):[],r=[];o.forEach((e,t)=>{var s=e.replace(i,"");s=s.replace(a,""),r.push(s)}),e.missing_words=r},checkSectionNames(e){var t=e.old_section_name,s=e.section_name;return s==t},getExt(e){var t=e,s=t.split("/"),i=s[s.length-1].split(".");return i[1]},close(){this.$nextTick(()=>{this.alert=!1,this.lessons.item.meta=Object.assign({},this.lessons.itemMetaDefault)})}}});