const splitted_domain=window.location.href.split("/"),course_slug=splitted_domain[4],lesson_id=splitted_domain[5],timezone=moment.tz.guess();Vue.component(VueCountdown.name,VueCountdown),moment.locale(app_language);let vm=new Vue({vuetify:vuetify,el:"#app-container",data:{course_id:"",drawer:!1,tab:null,nav_tab:null,loading:!1,join_loading:!1,lesson_tab:"overview",lesson_materials_sent_loading:!1,classmates_loading:!1,send_comment_loading:!1,skills_container:!1,resource_preview_dialog:!1,resource_preview_loading:!0,canPost:!1,selection:1,snackbar:!1,snackbar_timeout:5e3,snackbar_text:"",snackbar_type:"",zoom_countdown:1e3,countdown_container:{},show_button:!1,zoom_link:!1,meta:{},notifications:[],recent_questions:[],recent_contributions:[],classmates:[],comments:[],resources:[],resource_preview:{},comment:"",lesson_messages:new LessonMessage({uid:uid,lesson_id:lesson_id}),child_profile:new ChildProfile,student_materials_headers:[{text:"Student",align:"start",value:"full_name"}],students_selected:[],student_selected:{},customToolbar:[[{header:[!1,1,2,3,4,5,6]}],["bold","italic","underline","strike"],[{list:"ordered"},{list:"bullet"},{list:"check"}],["blockquote"],[{indent:"-1"},{indent:"+1"}][{align:"justify"}],[{indent:"-1"},{indent:"+1"}],["link"]],resources:[],lesson_materials_sent:[],resource_preview:{}},computed:{ScreenHeight:()=>window.screen.height-35*window.screen.height/100},watch:{zoom_countdown(val){val<=18e5&&(this.show_button=!0)},students_selected(val){this.student_selected=Object.assign({},val[0]),this.initializeLessonMaterialsSent({child_id:this.student_selected.user_id})}},created(){this.initialize(),this.initializeLessonResources(),this.initializeLessonClassmates(),this.initializeComments(),this.lesson_messages.load()},mounted(){this.$refs.hasOwnProperty("child_profile_select")&&this.child_profile.filterAndSelect(this.$refs.child_profile_select.items),this.course_id=this.$refs.lesson_container.getAttribute("data-course-id")},methods:{initialize(){var app=this,url=api_url+"course-lessons/get-meta-info/"+lesson_id;app.$http.get(url).then(res=>{res.body.length>0&&(res.body.forEach(meta=>{app.meta[meta.lesson_meta_name]=meta.lesson_meta_val,meta.lesson_meta_name}),app.meta.hasOwnProperty("zoom_start_time")&&(countdown=app.getTimeDifference(app.meta.zoom_start_time),app.zoom_countdown=countdown<0?0:countdown,app.countdown_container=app.$refs.meeting_countdown))},err=>{})},initializeComments(){var app=this,url=api_url+"lesson-comments/get/"+lesson_id;app.$http.post(url,{course_slug:course_slug}).then(res=>{res.body.length>0&&(app.comments=[],res.body.forEach(item=>{item.edit_comment_box=!1,item.edit_comment_loading=!1,item.edited_comment=item.comment,item.edit_answer_box=!1,item.edit_answer_loading=!1,item.edited_answer="",item.answer_loading=!1,item.edit_answer_loading=!1,item.answer="",item.answer_box=!1,app.comments.push(item)}))},err=>{})},initializeLessonClassmates(){var app=this,url=api_url+"lessons/get-classmates/"+lesson_id;app.classmates_loading=!0,app.$http.get(url).then(res=>{app.classmates_loading=!1,res.body.forEach(item=>{item.full_name=`${item.first_name} ${item.last_name}`}),app.classmates=res.body},err=>{})},initializeLessonResources(){var app=this,url=api_url+"media/get-lesson-resources/"+lesson_id;app.$http.get(url).then(res=>{res.body.length>0&&res.body.forEach(resource=>{resource.loading=!1,resource.percent_loading_active=!1,resource.percent_loading=0,resource.edit=!1,app.resources.push(resource)})},err=>{})},initializeLessonMaterialsSent({child_id:child_id=null}){var app=this,url=api_url+"lesson-materials-sent/get/"+lesson_id;app.lesson_materials_sent=[];var data={child_id:child_id};if(null==data.child_id)return console.log(data.child_id),!1;app.lesson_materials_sent_loading=!0,app.$http.post(url,data).then(res=>{res.body.length>0&&res.body.forEach(resource=>{resource.loading=!1,resource.percent_loading_active=!1,resource.percent_loading=0,resource.edit=!1,app.lesson_materials_sent.push(resource)}),app.lesson_materials_sent_loading=!1},err=>{})},transformSlotProps(props){const formattedProps={};return Object.entries(props).forEach(([key,value])=>{formattedProps[key]=value<10?`0${value}`:String(value)}),formattedProps},getTimeDifference(t){var tz=moment.tz.guess();return moment(t).tz(this.meta.zoom_timezone).diff(moment().tz(tz).format())},formatDate:d=>moment(d).format("LLL"),replaceString:(s,d,r)=>s.replace(d,r),joinClass(){var app=this;app.join_loading=!0;var url=api_url+"lessons/join-class/"+lesson_id;app.$http.post(url,{slug:course_slug}).then(res=>{"success"==res.body.status&&(window.open(app.meta.zoom_url,"_blank"),(res.body.data.hasOwnProperty("certified_url")&&""!==res.body.data.certified_url||res.body.data.hasOwnProperty("requireCertifiedPaid")&&2!=res.body.data.requireCertifiedPaid)&&(app.certified_url=res.body.data.certified_url,app.requireCertifiedPaid=res.body.data.requireCertifiedPaid,app.certified_approved_dialog=!0)),app.zoom_link=!0,app.join_loading=!1},err=>{app.join_loading=!1})},getExt(file_name){var url,splitted_url=file_name.split("/"),ext;return splitted_url[splitted_url.length-1].split(".")[1]},getExtIcon(file_name){var url,splitted_url=file_name.split("/"),ext,file_icon="";switch(splitted_url[splitted_url.length-1].split(".")[1]){case"pdf":file_icon="pdf-box";break;case"docx":case"doc":file_icon="word";break;case"ppt":case"pptx":case"ppt":file_icon="powerpoint";break;case"png":case"jpg":case"jpeg":file_icon="image";break;case"xls":case"xlsx":file_icon="excel";break;default:file_icon="document"}return file_icon},saveFile(url,loading_target){var app=this;loading_target=void 0===loading_target?app:loading_target;var filename=url.substring(url.lastIndexOf("/")+1).split("?")[0];app.$http.get(url,{responseType:"blob",progress(e){e.lengthComputable&&(loading_target.percent_loading_active=!0,loading_target.percent_loading=e.loaded/e.total*100)}}).then(res=>{var a=document.createElement("a");a.href=window.URL.createObjectURL(res.body),a.download=filename,a.style.display="none",document.body.appendChild(a),a.click(),delete a})},updateResource(resource,index){var app=this,url=api_url+"media/create",data=new FormData;resource.loading=!0,data.append("course_id",app.course_id),data.append("lesson_id",lesson_id),data.append("preview_only",resource.preview_only),data.append("resource_name",resource.name),data.append("media",resource.file),resource.hasOwnProperty("media_id")&&(data.append("media_id",resource.media_id),data.append("url",resource.url),url=api_url+"media/update"),app.$http.post(url,data,{progress(e){e.lengthComputable&&(resource.percent_loading_active=!0,resource.percent_loading=e.loaded/e.total*100)}}).then(res=>{"success"==res.body.status&&(resource.hasOwnProperty("media_id")||(resource.media_id=res.body.data.media_id),resource.url=res.body.data.url,resource.edit=!1),resource.loading=!1,resource.percent_loading_active=!1},err=>{resource.percent_loading_active=!1,resource.loading=!1})},removeResource(resource,index){var app=this;if(resource.hasOwnProperty("media_id")){var url=api_url+"media/delete";app.$http.post(url,resource).then(res=>{"success"==res.body.status&&app.resources.splice(index,1)},err=>{})}else app.resources.splice(index,1)},updateLessonMaterial({resource:resource,child_id:child_id=null}){var app=this,url=api_url+"lesson-materials-sent/create",data=new FormData;resource.loading=!0,resource.lesson_id=lesson_id,resource.children_id=resource.hasOwnProperty("children_id")?resource.children_id:null==child_id?app.student_selected.hasOwnProperty("user_id")?app.student_selected.user_id:app.child_profile.child_id:child_id,data.append("lesson_id",resource.lesson_id),data.append("children_id",resource.children_id),data.append("sender",resource.sender),data.append("resource_name",resource.name),data.append("material",resource.file),resource.hasOwnProperty("material_id")&&(data.append("material_id",resource.material_id),data.append("url",resource.url),url=api_url+"lesson-materials-sent/update"),app.$http.post(url,data,{progress(e){e.lengthComputable&&(resource.percent_loading_active=!0,resource.percent_loading=e.loaded/e.total*100)}}).then(res=>{"success"==res.body.status&&(resource.hasOwnProperty("material_id")||(resource.material_id=res.body.data.material_id),resource.url=res.body.data.url,resource.edit=!1),resource.loading=!1,resource.percent_loading_active=!1},err=>{resource.percent_loading_active=!1,resource.loading=!1})},removeLessonMaterial(resource,index){var app=this;if(resource.hasOwnProperty("material_id")){var url=api_url+"lesson-materials-sent/delete";app.$http.post(url,resource).then(res=>{"success"==res.body.status&&app.lesson_materials_sent.splice(index,1)},err=>{})}else app.lesson_materials_sent.splice(index,1)},saveComment(comment_type){var app=this,child=app.child_profile.child_selected;app.send_comment_loading=!0;var data={comment:app.comment,comment_type:comment_type,user_id:child.user_id,gender:child.gender,first_name:child.first_name,last_name:child.last_name,lesson_id:lesson_id},url=api_url+"lesson-comments/create";app.$http.post(url,data).then(res=>{app.send_comment_loading=!1,"success"==res.body.status&&(app.snackbar=!0,app.snackbar_text=res.body.message,app.snackbar_type="primary",data.editable=!0,data.edit_comment_box=!1,data.edit_comment_loading=!1,data.edited_comment=data.comment,data.edit_answer_box=!1,data.edit_answer_loading=!1,data.edited_answer="",data.answer_loading=!1,data.edit_answer_loading=!1,data.lesson_comment_id=res.body.data.lesson_comment_id,data.published_at=moment.utc(),app.comments.push(data),"question"==comment_type?app.recent_questions.push(data):"contribution"==comment_type&&app.recent_contributions.push(data),app.comment="")},err=>{app.send_comment_loading=!1,app.snackbar=!0,app.snackbar_text="S-a produs o eroare neașteptată la postarea comentariului",app.snackbar_type="primary"})},editComment(item){var app=this;app.edit_comment_loading=!0;var comment_index=app.comments.indexOf(item),data={lesson_comment_id:item.lesson_comment_id,comment:item.edited_comment},url=api_url+"lesson-comments/update";app.$http.post(url,data).then(res=>{app.edit_comment_loading=!1,"success"==res.body.status&&(app.snackbar=!0,app.snackbar_text=res.body.message,app.snackbar_type="primary",item.comment=data.comment,item.edit_answer_box=!1,Object.assign(app.comments[comment_index],item))},err=>{app.edit_comment_loading=!1,app.snackbar=!0,app.snackbar_text="S-a produs o eroare neașteptată în timpul actualizării",app.snackbar_type="primary"})},saveAnswer(item){var app=this;app.answer_loading=!0;var comment_index=app.comments.indexOf(item),data={comment:item.answer,lesson_comment_id:item.lesson_comment_id},url=api_url+"lesson-comments-answers/create";app.$http.post(url,data).then(res=>{app.answer_loading=!1,"success"==res.body.status&&(app.snackbar=!0,app.snackbar_text=res.body.message,app.snackbar_type="primary",data.editable=!0,data.lesson_comment_answer_id=res.body.data.lesson_answer_comment_id,data.avatar=res.body.data.avatar,data.first_name=res.body.data.first_name,data.last_name=res.body.data.last_name,data.username=res.body.data.username,data.published_at=moment.utc(),app.comments[comment_index].answers.push(data))},err=>{app.answer_loading=!1,app.snackbar=!0,app.snackbar_text="S-a produs o eroare neașteptată la postarea comentariului",app.snackbar_type="primary"})},editAnswer(item,answer){var app=this;app.edit_answer_box=!0;var comment_index=app.comments.indexOf(item),answer_index=app.comments[comment_index].answers.indexOf(answer),data={lesson_comment_answer_id:answer.lesson_comment_answer_id,comment:answer.edited_answer},url=api_url+"lesson-comments-answers/update";app.$http.post(url,data).then(res=>{app.edit_comment_loading=!1,"success"==res.body.status&&(app.snackbar=!0,app.snackbar_text=res.body.message,app.snackbar_type="primary",answer.comment=data.comment,Object.assign(app.comments[comment_index].answers[answer_index],answer))},err=>{app.edit_comment_loading=!1,app.snackbar=!0,app.snackbar_text="S-a produs o eroare neașteptată în timpul actualizării",app.snackbar_type="primary"})},deleteComment(item){var app=this,url=api_url+"lesson-comments/delete/",comment_index=this.comments.indexOf(item),data=Object.assign({},item);data.lesson_id=lesson_id,app.$http.post(url,data).then(res=>{app.snackbar=!0,app.snackbar_text=res.body.message,app.snackbar_type="primary","success"==res.body.status&&app.comments.splice(comment_index,1)},err=>{app.send_comment_loading=!1,app.snackbar=!0,app.snackbar_text="S-a produs o eroare neașteptată la postarea comentariului",app.snackbar_type="primary"})},deleteAnswer(item){var app=this,url=api_url+"lesson-comments/delete/",comment_index=this.comments.indexOf(item),data=Object.assign({},item);data.lesson_id=lesson_id,app.$http.post(url,data).then(res=>{app.snackbar=!0,app.snackbar_text=res.body.message,app.snackbar_type="primary","success"==res.body.status&&app.comments.splice(comment_index,1)},err=>{app.send_comment_loading=!1,app.snackbar=!0,app.snackbar_text="S-a produs o eroare neașteptată la postarea comentariului",app.snackbar_type="primary"})},getFullName:item=>item.first_name+" "+item.last_name,fromNow(date_time){var cest;return moment.tz(date_time,"Europe/Berlin").tz(timezone).fromNow()}}});