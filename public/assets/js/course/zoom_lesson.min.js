const splitted_domain=window.location.href.split("/"),course_slug=splitted_domain[4],lesson_id=splitted_domain[5],timezone=moment.tz.guess();Vue.component(VueCountdown.name,VueCountdown),moment.locale(app_language);let vm=new Vue({vuetify:vuetify,el:"#app-container",data:{course_id:"",drawer:!1,tab:null,nav_tab:null,loading:!1,join_loading:!1,lesson_tab:"overview",lesson_materials_sent_loading:!1,classmates_loading:!1,send_comment_loading:!1,skills_container:!1,resource_preview_dialog:!1,resource_preview_loading:!0,canPost:!1,selection:1,snackbar:!1,snackbar_timeout:5e3,snackbar_text:"",snackbar_type:"",zoom_countdown:1e3,countdown_container:{},show_button:!1,zoom_link:!1,meta:{},notifications:[],recent_questions:[],recent_contributions:[],classmates:[],comments:[],resources:[],resource_preview:{},comment:"",lesson_messages:new LessonMessage({uid:uid,lesson_id:lesson_id}),child_profile:new ChildProfile,student_materials_headers:[{text:"Student",align:"start",value:"full_name"}],students_selected:[],student_selected:{},customToolbar:[[{header:[!1,1,2,3,4,5,6]}],["bold","italic","underline","strike"],[{list:"ordered"},{list:"bullet"},{list:"check"}],["blockquote"],[{indent:"-1"},{indent:"+1"}][{align:"justify"}],[{indent:"-1"},{indent:"+1"}],["link"]],resources:[],lesson_materials_sent:[],resource_preview:{}},computed:{ScreenHeight:()=>window.screen.height-35*window.screen.height/100},watch:{zoom_countdown(e){e<=18e5&&(this.show_button=!0)},students_selected(e){this.student_selected=Object.assign({},e[0]),this.initializeLessonMaterialsSent({child_id:this.student_selected.user_id})}},created(){this.initialize(),this.initializeLessonResources(),this.initializeLessonClassmates(),this.initializeComments(),this.lesson_messages.load()},mounted(){this.$refs.hasOwnProperty("child_profile_select")&&this.child_profile.filterAndSelect(this.$refs.child_profile_select.items),this.course_id=this.$refs.lesson_container.getAttribute("data-course-id")},methods:{initialize(){var e=this,t=api_url+"course-lessons/get-meta-info/"+lesson_id;e.$http.get(t).then(t=>{t.body.length>0&&t.body.forEach(t=>{e.meta[t.lesson_meta_name]=t.lesson_meta_val,"zoom_start_time"==t.lesson_meta_name&&(countdown=e.getTimeDifference(t.lesson_meta_val),e.zoom_countdown=countdown<0?0:countdown,e.countdown_container=e.$refs.meeting_countdown)})},e=>{})},initializeComments(){var e=this,t=api_url+"lesson-comments/get/"+lesson_id;e.$http.post(t,{course_slug:course_slug}).then(t=>{t.body.length>0&&(e.comments=[],t.body.forEach(t=>{t.edit_comment_box=!1,t.edit_comment_loading=!1,t.edited_comment=t.comment,t.edit_answer_box=!1,t.edit_answer_loading=!1,t.edited_answer="",t.answer_loading=!1,t.edit_answer_loading=!1,t.answer="",t.answer_box=!1,e.comments.push(t)}))},e=>{})},initializeLessonClassmates(){var e=this,t=api_url+"lessons/get-classmates/"+lesson_id;e.classmates_loading=!0,e.$http.get(t).then(t=>{e.classmates_loading=!1,t.body.forEach(e=>{e.full_name=`${e.first_name} ${e.last_name}`}),e.classmates=t.body},e=>{})},initializeLessonResources(){var e=this,t=api_url+"media/get-lesson-resources/"+lesson_id;e.$http.get(t).then(t=>{t.body.length>0&&t.body.forEach(t=>{t.loading=!1,t.percent_loading_active=!1,t.percent_loading=0,t.edit=!1,e.resources.push(t)})},e=>{})},initializeLessonMaterialsSent({child_id:e=null}){var t=this,s=api_url+"lesson-materials-sent/get/"+lesson_id;t.lesson_materials_sent=[];var a={child_id:e};if(null==a.child_id)return console.log(a.child_id),!1;t.lesson_materials_sent_loading=!0,t.$http.post(s,a).then(e=>{e.body.length>0&&e.body.forEach(e=>{e.loading=!1,e.percent_loading_active=!1,e.percent_loading=0,e.edit=!1,t.lesson_materials_sent.push(e)}),t.lesson_materials_sent_loading=!1},e=>{})},transformSlotProps(e){const t={};return Object.entries(e).forEach(([e,s])=>{t[e]=s<10?`0${s}`:String(s)}),t},getTimeDifference(e){var t=moment.tz.guess();return moment(e).tz(this.meta.zoom_timezone).diff(moment().tz(t).format())},formatDate:e=>moment(e).format("LLL"),replaceString:(e,t,s)=>e.replace(t,s),joinClass(){var e=this;e.join_loading=!0;var t=api_url+"lessons/join-class/"+lesson_id;e.$http.post(t,{slug:course_slug}).then(t=>{"success"==t.body.status&&(window.open(e.meta.zoom_url,"_blank"),(t.body.data.hasOwnProperty("certified_url")&&""!==t.body.data.certified_url||t.body.data.hasOwnProperty("requireCertifiedPaid")&&2!=t.body.data.requireCertifiedPaid)&&(e.certified_url=t.body.data.certified_url,e.requireCertifiedPaid=t.body.data.requireCertifiedPaid,e.certified_approved_dialog=!0)),e.zoom_link=!0,e.join_loading=!1},t=>{e.join_loading=!1})},getExt(e){var t=e,s=t.split("/"),a=s[s.length-1].split(".");return a[1]},getExtIcon(e){var t=e,s=t.split("/"),a=s[s.length-1].split("."),n="";switch(a[1]){case"pdf":n="pdf-box";break;case"docx":case"doc":n="word";break;case"ppt":case"pptx":case"ppt":n="powerpoint";break;case"png":case"jpg":case"jpeg":n="image";break;case"xls":case"xlsx":n="excel";break;default:n="document"}return n},saveFile(e,t){var s=this;t=void 0===t?s:t;var a=e.substring(e.lastIndexOf("/")+1).split("?")[0];s.$http.get(e,{responseType:"blob",progress(e){e.lengthComputable&&(t.percent_loading_active=!0,t.percent_loading=e.loaded/e.total*100)}}).then(e=>{var t=document.createElement("a");t.href=window.URL.createObjectURL(e.body),t.download=a,t.style.display="none",document.body.appendChild(t),t.click(),delete t})},updateResource(e,t){var s=this,a=api_url+"media/create",n=new FormData;e.loading=!0,n.append("course_id",s.course_id),n.append("lesson_id",lesson_id),n.append("preview_only",e.preview_only),n.append("resource_name",e.name),n.append("media",e.file),e.hasOwnProperty("media_id")&&(n.append("media_id",e.media_id),n.append("url",e.url),a=api_url+"media/update"),s.$http.post(a,n,{progress(t){t.lengthComputable&&(e.percent_loading_active=!0,e.percent_loading=t.loaded/t.total*100)}}).then(t=>{"success"==t.body.status&&(e.hasOwnProperty("media_id")||(e.media_id=t.body.data.media_id),e.url=t.body.data.url,e.edit=!1),e.loading=!1,e.percent_loading_active=!1},t=>{e.percent_loading_active=!1,e.loading=!1})},removeResource(e,t){var s=this;if(e.hasOwnProperty("media_id")){var a=api_url+"media/delete";s.$http.post(a,e).then(e=>{"success"==e.body.status&&s.resources.splice(t,1)},e=>{})}else s.resources.splice(t,1)},updateLessonMaterial({resource:e,child_id:t=null}){var s=this,a=api_url+"lesson-materials-sent/create",n=new FormData;e.loading=!0,e.lesson_id=lesson_id,e.children_id=e.hasOwnProperty("children_id")?e.children_id:null==t?s.student_selected.hasOwnProperty("user_id")?s.student_selected.user_id:s.child_profile.child_id:t,n.append("lesson_id",e.lesson_id),n.append("children_id",e.children_id),n.append("sender",e.sender),n.append("resource_name",e.name),n.append("material",e.file),e.hasOwnProperty("material_id")&&(n.append("material_id",e.material_id),n.append("url",e.url),a=api_url+"lesson-materials-sent/update"),s.$http.post(a,n,{progress(t){t.lengthComputable&&(e.percent_loading_active=!0,e.percent_loading=t.loaded/t.total*100)}}).then(t=>{"success"==t.body.status&&(e.hasOwnProperty("material_id")||(e.material_id=t.body.data.material_id),e.url=t.body.data.url,e.edit=!1),e.loading=!1,e.percent_loading_active=!1},t=>{e.percent_loading_active=!1,e.loading=!1})},removeLessonMaterial(e,t){var s=this;if(e.hasOwnProperty("material_id")){var a=api_url+"lesson-materials-sent/delete";s.$http.post(a,e).then(e=>{"success"==e.body.status&&s.lesson_materials_sent.splice(t,1)},e=>{})}else s.lesson_materials_sent.splice(t,1)},saveComment(e){var t=this,s=t.child_profile.child_selected;t.send_comment_loading=!0;var a={comment:t.comment,comment_type:e,user_id:s.user_id,gender:s.gender,first_name:s.first_name,last_name:s.last_name,lesson_id:lesson_id},n=api_url+"lesson-comments/create";t.$http.post(n,a).then(s=>{t.send_comment_loading=!1,"success"==s.body.status&&(t.snackbar=!0,t.snackbar_text=s.body.message,t.snackbar_type="primary",a.editable=!0,a.edit_comment_box=!1,a.edit_comment_loading=!1,a.edited_comment=a.comment,a.edit_answer_box=!1,a.edit_answer_loading=!1,a.edited_answer="",a.answer_loading=!1,a.edit_answer_loading=!1,a.lesson_comment_id=s.body.data.lesson_comment_id,a.published_at=moment.utc(),t.comments.push(a),"question"==e?t.recent_questions.push(a):"contribution"==e&&t.recent_contributions.push(a),t.comment="")},e=>{t.send_comment_loading=!1,t.snackbar=!0,t.snackbar_text="S-a produs o eroare neașteptată la postarea comentariului",t.snackbar_type="primary"})},editComment(e){var t=this;t.edit_comment_loading=!0;var s=t.comments.indexOf(e),a={lesson_comment_id:e.lesson_comment_id,comment:e.edited_comment},n=api_url+"lesson-comments/update";t.$http.post(n,a).then(n=>{t.edit_comment_loading=!1,"success"==n.body.status&&(t.snackbar=!0,t.snackbar_text=n.body.message,t.snackbar_type="primary",e.comment=a.comment,e.edit_answer_box=!1,Object.assign(t.comments[s],e))},e=>{t.edit_comment_loading=!1,t.snackbar=!0,t.snackbar_text="S-a produs o eroare neașteptată în timpul actualizării",t.snackbar_type="primary"})},saveAnswer(e){var t=this;t.answer_loading=!0;var s=t.comments.indexOf(e),a={comment:e.answer,lesson_comment_id:e.lesson_comment_id},n=api_url+"lesson-comments-answers/create";t.$http.post(n,a).then(e=>{t.answer_loading=!1,"success"==e.body.status&&(t.snackbar=!0,t.snackbar_text=e.body.message,t.snackbar_type="primary",a.editable=!0,a.lesson_comment_answer_id=e.body.data.lesson_answer_comment_id,a.avatar=e.body.data.avatar,a.first_name=e.body.data.first_name,a.last_name=e.body.data.last_name,a.username=e.body.data.username,a.published_at=moment.utc(),t.comments[s].answers.push(a))},e=>{t.answer_loading=!1,t.snackbar=!0,t.snackbar_text="S-a produs o eroare neașteptată la postarea comentariului",t.snackbar_type="primary"})},editAnswer(e,t){var s=this;s.edit_answer_box=!0;var a=s.comments.indexOf(e),n=s.comments[a].answers.indexOf(t),i={lesson_comment_answer_id:t.lesson_comment_answer_id,comment:t.edited_answer},o=api_url+"lesson-comments-answers/update";s.$http.post(o,i).then(e=>{s.edit_comment_loading=!1,"success"==e.body.status&&(s.snackbar=!0,s.snackbar_text=e.body.message,s.snackbar_type="primary",t.comment=i.comment,Object.assign(s.comments[a].answers[n],t))},e=>{s.edit_comment_loading=!1,s.snackbar=!0,s.snackbar_text="S-a produs o eroare neașteptată în timpul actualizării",s.snackbar_type="primary"})},deleteComment(e){var t=this,s=api_url+"lesson-comments/delete/",a=this.comments.indexOf(e),n=Object.assign({},e);n.lesson_id=lesson_id,t.$http.post(s,n).then(e=>{t.snackbar=!0,t.snackbar_text=e.body.message,t.snackbar_type="primary","success"==e.body.status&&t.comments.splice(a,1)},e=>{t.send_comment_loading=!1,t.snackbar=!0,t.snackbar_text="S-a produs o eroare neașteptată la postarea comentariului",t.snackbar_type="primary"})},deleteAnswer(e){var t=this,s=api_url+"lesson-comments/delete/",a=this.comments.indexOf(e),n=Object.assign({},e);n.lesson_id=lesson_id,t.$http.post(s,n).then(e=>{t.snackbar=!0,t.snackbar_text=e.body.message,t.snackbar_type="primary","success"==e.body.status&&t.comments.splice(a,1)},e=>{t.send_comment_loading=!1,t.snackbar=!0,t.snackbar_text="S-a produs o eroare neașteptată la postarea comentariului",t.snackbar_type="primary"})},getFullName:e=>e.first_name+" "+e.last_name,fromNow(e){var t=moment.tz(e,"Europe/Berlin");return t.tz(timezone).fromNow()}}});