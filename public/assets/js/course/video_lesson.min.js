const splitted_domain=window.location.href.split("/"),course_slug=splitted_domain[4],lesson_id=splitted_domain[5],timezone=moment.tz.guess();Vue.component("video-player",VueVideoPlayer.videoPlayer),moment.locale("es");let vm=new Vue({vuetify:vuetify,el:"#full-learning-container",data:{drawer:!1,tab:null,nav_tab:null,sidebar_tab:"contributions",loading:!1,video_loading:!0,resource_preview_loading:!0,send_comment_loading:!1,skills_container:!1,previous_video_time:!1,current_video_time:!1,canPost:!1,snackbar:!1,playing:!1,percent_loading_active:!1,resource_preview_dialog:!1,certified_approved_dialog:!1,certified_loading:!1,certified_url:"",requireCertifiedPaid:!1,saveTimeInterval:void 0,percent_loading:0,snackbar_timeout:5e3,snackbar_text:"",snackbar_type:"",selection:1,comment:"",notifications:[],recent_questions:[],recent_contributions:[],comments:[],resources:[],resource_preview:{},toolbar:[["bold","italic","underline"],[{list:"ordered"},{list:"bullet"}],[{align:""},{align:"center"},{align:"right"},{align:"justify"}],[{color:[]}],["link"]],meta:{video_url:"",poster_url:""},playerOptions:{fluid:!0,autoplay:!1,language:"es",playbackRates:[.7,1,1.5,2],sources:[{type:"video/mp4",src:"",label:"1080p",selected:!0}],html5:{hls:{overrideNative:!0},nativeAudioTracks:!1,nativeVideoTracks:!1},poster:""},resolutions:["720p","480p","360p","240p"]},computed:{ScreenHeight:()=>window.screen.height-35*window.screen.height/100,player(){return this.$refs.videoPlayer.player}},watch:{comment(e){this.canPost=""==e}},created(){this.initialize(),this.initializeComments(),this.initializeLessonResources()},mounted(){},methods:{initialize(){var e=this,t=api_url+"course-lessons/get-meta-info/"+lesson_id;e.$http.get(t).then(t=>{t.body.length>0&&(t.body.forEach(t=>{e.meta[t.lesson_meta_name]=t.lesson_meta_val}),e.playerOptions.sources[0].src=e.meta.video_url,e.resolutions.forEach(t=>{if(e.meta.hasOwnProperty("video_url_"+t)){var a={type:"video/mp4",src:e.meta["video_url_"+t],label:t};e.playerOptions.sources.push(a)}}),e.meta.hasOwnProperty("video_poster")&&""!=e.meta.video_poster&&(e.playerOptions.sources[0].poster=e.meta.poster_url)),e.video_loading=!1},t=>{e.video_loading=!1})},initializeComments(){var e=this,t=api_url+"lesson-comments/get/"+lesson_id;e.$http.post(t,{course_slug:course_slug}).then(t=>{t.body.length>0&&(e.comments=[],t.body.forEach(t=>{t.edit_comment_box=!1,t.edit_comment_loading=!1,t.edited_comment=t.comment,t.edit_answer_box=!1,t.edit_answer_loading=!1,t.edited_answer="",t.answer_loading=!1,t.edit_answer_loading=!1,t.answer="",t.answer_box=!1,e.comments.push(t)}))},e=>{})},initializeLessonResources(){var e=this,t=api_url+"media/get-lesson-resources/"+lesson_id;e.$http.get(t).then(t=>{t.body.length>0&&t.body.forEach((t,a)=>{t.loading=!1,t.percent_loading_active=!1,t.percent_loading=0,e.resources.push(t)})},e=>{})},restoreVideo(){this.$refs.videoPlayer.dispose(),this.$refs.videoPlayer.initialize()},onPlayerPlay(e){vm.$data.playing=!0},onPlayerPause(e){vm.$data.playing=!1},onPlayerEnded(e){vm.$data.playing=!1},onPlayerLoadeddata(e){},onPlayerWaiting(e){},onPlayerPlaying(e){var t=this.saveTimeInterval;t>0&&clearTimeout(this.saveTimeInterval),function(){e.ended()||vm.storeVideoTime(),vm.$data.saveTimeInterval=setTimeout(arguments.callee,9e3)}()},onPlayerTimeupdate(e){},onPlayerCanplay(e){},onPlayerCanplaythrough(e){},playerStateChanged(e){},playerReadied(e){e.videoJsResolutionSwitcher()},getCurrentTime(){return this.$refs.videoPlayer.player.currentTime()},getVideoDuration(){return this.$refs.videoPlayer.player.duration()},storeVideoTime(){var e=this;if(!e.playing)return!1;var t=e.getCurrentTime(),a=e.getVideoDuration(),s=a-t,n=parseInt(100*s/a),o={slug:course_slug,video_time:a,video_missing:n},i=api_url+"lessons/save-video-progress/"+lesson_id;e.$http.post(i,o).then(t=>{(t.body.data.hasOwnProperty("certified_url")&&""!==t.body.data.certified_url||t.body.data.hasOwnProperty("requireCertifiedPaid")&&2!=t.body.data.requireCertifiedPaid)&&(e.certified_url=t.body.data.certified_url,e.requireCertifiedPaid=t.body.data.requireCertifiedPaid,e.certified_approved_dialog=!0)},e=>{})},saveComment(e){var t=this;t.send_comment_loading=!0;var a={comment:t.comment,comment_type:e,lesson_id:lesson_id},s=api_url+"lesson-comments/create";t.$http.post(s,a).then(s=>{t.send_comment_loading=!1,"success"==s.body.status&&(t.snackbar=!0,t.snackbar_text=s.body.message,t.snackbar_type="primary",a.editable=!0,a.edit_comment_box=!1,a.edit_comment_loading=!1,a.edited_comment=a.comment,a.edit_answer_box=!1,a.edit_answer_loading=!1,a.edited_answer="",a.answer_loading=!1,a.edit_answer_loading=!1,a.lesson_comment_id=s.body.data.lesson_comment_id,a.avatar=s.body.data.avatar,a.first_name=s.body.data.first_name,a.last_name=s.body.data.last_name,a.username=s.body.data.username,a.published_at=moment.utc(),t.comments.push(a),"question"==e?t.recent_questions.push(a):"contribution"==e&&t.recent_contributions.push(a),t.comment="")},e=>{t.send_comment_loading=!1,t.snackbar=!0,t.snackbar_text="Hubo un error inesperado al publicar el comentario",t.snackbar_type="primary"})},editComment(e){var t=this;t.edit_comment_loading=!0;var a=t.comments.indexOf(e),s={lesson_comment_id:e.lesson_comment_id,comment:e.edited_comment},n=api_url+"lesson-comments/update";t.$http.post(n,s).then(n=>{t.edit_comment_loading=!1,"success"==n.body.status&&(t.snackbar=!0,t.snackbar_text=n.body.message,t.snackbar_type="primary",e.comment=s.comment,e.edit_answer_box=!1,Object.assign(t.comments[a],e))},e=>{t.edit_comment_loading=!1,t.snackbar=!0,t.snackbar_text="Hubo un error inesperado al actualizar",t.snackbar_type="primary"})},saveAnswer(e){var t=this;t.answer_loading=!0;var a=t.comments.indexOf(e),s={comment:e.answer,lesson_comment_id:e.lesson_comment_id},n=api_url+"lesson-comments-answers/create";t.$http.post(n,s).then(e=>{t.answer_loading=!1,"success"==e.body.status&&(t.snackbar=!0,t.snackbar_text=e.body.message,t.snackbar_type="primary",s.editable=!0,s.lesson_comment_answer_id=e.body.data.lesson_answer_comment_id,s.avatar=e.body.data.avatar,s.first_name=e.body.data.first_name,s.last_name=e.body.data.last_name,s.username=e.body.data.username,s.published_at=moment.utc(),t.comments[a].answers.push(s))},e=>{t.answer_loading=!1,t.snackbar=!0,t.snackbar_text="Hubo un error inesperado al publicar el comentario",t.snackbar_type="primary"})},editAnswer(e,t){var a=this;a.edit_answer_box=!0;var s=a.comments.indexOf(e),n=a.comments[s].answers.indexOf(t),o={lesson_comment_answer_id:t.lesson_comment_answer_id,comment:t.edited_answer},i=api_url+"lesson-comments-answers/update";a.$http.post(i,o).then(e=>{a.edit_comment_loading=!1,"success"==e.body.status&&(a.snackbar=!0,a.snackbar_text=e.body.message,a.snackbar_type="primary",t.comment=o.comment,Object.assign(a.comments[s].answers[n],t))},e=>{a.edit_comment_loading=!1,a.snackbar=!0,a.snackbar_text="Hubo un error inesperado al actualizar",a.snackbar_type="primary"})},deleteComment(e){var t=this,a=api_url+"lesson-comments/delete/",s=this.comments.indexOf(e),n=Object.assign({},e);n.lesson_id=lesson_id,t.$http.post(a,n).then(e=>{t.snackbar=!0,t.snackbar_text=e.body.message,t.snackbar_type="primary","success"==e.body.status&&t.comments.splice(s,1)},e=>{t.send_comment_loading=!1,t.snackbar=!0,t.snackbar_text="Hubo un error inesperado al publicar el comentario",t.snackbar_type="primary"})},deleteAnswer(e){var t=this,a=api_url+"lesson-comments/delete/",s=this.comments.indexOf(e),n=Object.assign({},e);n.lesson_id=lesson_id,t.$http.post(a,n).then(e=>{t.snackbar=!0,t.snackbar_text=e.body.message,t.snackbar_type="primary","success"==e.body.status&&t.comments.splice(s,1)},e=>{t.send_comment_loading=!1,t.snackbar=!0,t.snackbar_text="Hubo un error inesperado al publicar el comentario",t.snackbar_type="primary"})},getFullName:e=>e.first_name+" "+e.last_name,fromNow(e){var t=moment.tz(e,"Europe/Berlin");return t.tz(timezone).fromNow()},getExt(e){var t=e,a=t.split("/"),s=a[a.length-1].split(".");return s[1]},getExtIcon(e){var t=e,a=t.split("/"),s=a[a.length-1].split("."),n="";switch(s[1]){case"pdf":n="pdf";break;case"docx":case"doc":n="word";break;case"ppt":case"pptx":case"ppt":n="powerpoint";break;case"xls":n="excel";break;default:n="document"}return n},isLocalFile:e=>!!e.includes(domain),saveFile(e,t){var a=this;t=void 0===t?a:t;var s=e.substring(e.lastIndexOf("/")+1).split("?")[0];a.$http.get(e,{responseType:"blob",progress(e){e.lengthComputable&&(t.percent_loading_active=!0,t.percent_loading=e.loaded/e.total*100)}}).then(e=>{var t=document.createElement("a");t.href=window.URL.createObjectURL(e.body),t.download=s,t.style.display="none",document.body.appendChild(t),t.click(),delete t})}}});