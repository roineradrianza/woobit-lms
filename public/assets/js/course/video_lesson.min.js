const splitted_domain=window.location.href.split("/"),course_slug=splitted_domain[4],lesson_id=splitted_domain[5],timezone=moment.tz.guess();Vue.component("video-player",VueVideoPlayer.videoPlayer),moment.locale(app_language);let vm=new Vue({vuetify:vuetify,el:"#app-container",data:{drawer:!1,tab:null,nav_tab:null,sidebar_tab:"contributions",loading:!1,video_loading:!0,resource_preview_loading:!0,send_comment_loading:!1,skills_container:!1,previous_video_time:!1,current_video_time:!1,canPost:!1,snackbar:!1,playing:!1,percent_loading_active:!1,resource_preview_dialog:!1,certified_approved_dialog:!1,certified_loading:!1,certified_url:"",requireCertifiedPaid:!1,saveTimeInterval:void 0,percent_loading:0,snackbar_timeout:5e3,snackbar_text:"",snackbar_type:"",selection:1,comment:"",notifications:[],recent_questions:[],recent_contributions:[],comments:[],resources:[],resource_preview:{},toolbar:[["bold","italic","underline"],[{list:"ordered"},{list:"bullet"}],[{align:""},{align:"center"},{align:"right"},{align:"justify"}],[{color:[]}],["link"]],meta:{video_url:"",poster_url:""},playerOptions:{fluid:!0,autoplay:!1,language:"es",playbackRates:[.7,1,1.5,2],sources:[{type:"video/mp4",src:"",label:"1080p",selected:!0}],html5:{hls:{overrideNative:!0},nativeAudioTracks:!1,nativeVideoTracks:!1},poster:""},resolutions:["720p","480p","360p","240p"]},computed:{ScreenHeight:()=>window.screen.height-35*window.screen.height/100,player(){return this.$refs.videoPlayer.player}},watch:{comment(e){this.canPost=""==e}},created(){this.initialize(),this.initializeComments(),this.initializeLessonResources()},mounted(){},methods:{initialize(){var e=this,a=api_url+"course-lessons/get-meta-info/"+lesson_id;e.$http.get(a).then(a=>{a.body.length>0&&(a.body.forEach(a=>{e.meta[a.lesson_meta_name]=a.lesson_meta_val}),e.playerOptions.sources[0].src=e.meta.video_url,e.resolutions.forEach(a=>{if(e.meta.hasOwnProperty("video_url_"+a)){var t={type:"video/mp4",src:e.meta["video_url_"+a],label:a};e.playerOptions.sources.push(t)}}),e.meta.hasOwnProperty("video_poster")&&""!=e.meta.video_poster&&(e.playerOptions.sources[0].poster=e.meta.poster_url)),e.video_loading=!1},a=>{e.video_loading=!1})},initializeComments(){var e=this,a=api_url+"lesson-comments/get/"+lesson_id;e.$http.post(a,{course_slug:course_slug}).then(a=>{a.body.length>0&&(e.comments=[],a.body.forEach(a=>{a.edit_comment_box=!1,a.edit_comment_loading=!1,a.edited_comment=a.comment,a.edit_answer_box=!1,a.edit_answer_loading=!1,a.edited_answer="",a.answer_loading=!1,a.edit_answer_loading=!1,a.answer="",a.answer_box=!1,e.comments.push(a)}))},e=>{})},initializeLessonResources(){var e=this,a=api_url+"media/get-lesson-resources/"+lesson_id;e.$http.get(a).then(a=>{a.body.length>0&&a.body.forEach((a,t)=>{a.loading=!1,a.percent_loading_active=!1,a.percent_loading=0,e.resources.push(a)})},e=>{})},restoreVideo(){this.$refs.videoPlayer.dispose(),this.$refs.videoPlayer.initialize()},onPlayerPlay(e){vm.$data.playing=!0},onPlayerPause(e){vm.$data.playing=!1},onPlayerEnded(e){vm.$data.playing=!1},onPlayerLoadeddata(e){},onPlayerWaiting(e){},onPlayerPlaying(e){var a=this.saveTimeInterval;a>0&&clearTimeout(this.saveTimeInterval),function(){e.ended()||vm.storeVideoTime(),vm.$data.saveTimeInterval=setTimeout(arguments.callee,9e3)}()},onPlayerTimeupdate(e){},onPlayerCanplay(e){},onPlayerCanplaythrough(e){},playerStateChanged(e){},playerReadied(e){e.videoJsResolutionSwitcher()},getCurrentTime(){return this.$refs.videoPlayer.player.currentTime()},getVideoDuration(){return this.$refs.videoPlayer.player.duration()},storeVideoTime(){var e=this;if(!e.playing)return!1;var a=e.getCurrentTime(),t=e.getVideoDuration(),s=t-a,n=parseInt(100*s/t),o={slug:course_slug,video_time:t,video_missing:n},i=api_url+"lessons/save-video-progress/"+lesson_id;e.$http.post(i,o).then(a=>{(a.body.data.hasOwnProperty("certified_url")&&""!==a.body.data.certified_url||a.body.data.hasOwnProperty("requireCertifiedPaid")&&2!=a.body.data.requireCertifiedPaid)&&(e.certified_url=a.body.data.certified_url,e.requireCertifiedPaid=a.body.data.requireCertifiedPaid,e.certified_approved_dialog=!0)},e=>{})},saveComment(e){var a=this;a.send_comment_loading=!0;var t={comment:a.comment,comment_type:e,lesson_id:lesson_id},s=api_url+"lesson-comments/create";a.$http.post(s,t).then(s=>{a.send_comment_loading=!1,"success"==s.body.status&&(a.snackbar=!0,a.snackbar_text=s.body.message,a.snackbar_type="primary",t.editable=!0,t.edit_comment_box=!1,t.edit_comment_loading=!1,t.edited_comment=t.comment,t.edit_answer_box=!1,t.edit_answer_loading=!1,t.edited_answer="",t.answer_loading=!1,t.edit_answer_loading=!1,t.lesson_comment_id=s.body.data.lesson_comment_id,t.avatar=s.body.data.avatar,t.first_name=s.body.data.first_name,t.last_name=s.body.data.last_name,t.username=s.body.data.username,t.published_at=moment.utc(),a.comments.push(t),"question"==e?a.recent_questions.push(t):"contribution"==e&&a.recent_contributions.push(t),a.comment="")},e=>{a.send_comment_loading=!1,a.snackbar=!0,a.snackbar_text="Hubo un error inesperado al publicar el comentario",a.snackbar_type="primary"})},editComment(e){var a=this;a.edit_comment_loading=!0;var t=a.comments.indexOf(e),s={lesson_comment_id:e.lesson_comment_id,comment:e.edited_comment},n=api_url+"lesson-comments/update";a.$http.post(n,s).then(n=>{a.edit_comment_loading=!1,"success"==n.body.status&&(a.snackbar=!0,a.snackbar_text=n.body.message,a.snackbar_type="primary",e.comment=s.comment,e.edit_answer_box=!1,Object.assign(a.comments[t],e))},e=>{a.edit_comment_loading=!1,a.snackbar=!0,a.snackbar_text="Hubo un error inesperado al actualizar",a.snackbar_type="primary"})},saveAnswer(e){var a=this;a.answer_loading=!0;var t=a.comments.indexOf(e),s={comment:e.answer,lesson_comment_id:e.lesson_comment_id},n=api_url+"lesson-comments-answers/create";a.$http.post(n,s).then(e=>{a.answer_loading=!1,"success"==e.body.status&&(a.snackbar=!0,a.snackbar_text=e.body.message,a.snackbar_type="primary",s.editable=!0,s.lesson_comment_answer_id=e.body.data.lesson_answer_comment_id,s.avatar=e.body.data.avatar,s.first_name=e.body.data.first_name,s.last_name=e.body.data.last_name,s.username=e.body.data.username,s.published_at=moment.utc(),a.comments[t].answers.push(s))},e=>{a.answer_loading=!1,a.snackbar=!0,a.snackbar_text="Hubo un error inesperado al publicar el comentario",a.snackbar_type="primary"})},editAnswer(e,a){var t=this;t.edit_answer_box=!0;var s=t.comments.indexOf(e),n=t.comments[s].answers.indexOf(a),o={lesson_comment_answer_id:a.lesson_comment_answer_id,comment:a.edited_answer},i=api_url+"lesson-comments-answers/update";t.$http.post(i,o).then(e=>{t.edit_comment_loading=!1,"success"==e.body.status&&(t.snackbar=!0,t.snackbar_text=e.body.message,t.snackbar_type="primary",a.comment=o.comment,Object.assign(t.comments[s].answers[n],a))},e=>{t.edit_comment_loading=!1,t.snackbar=!0,t.snackbar_text="Hubo un error inesperado al actualizar",t.snackbar_type="primary"})},deleteComment(e){var a=this,t=api_url+"lesson-comments/delete/",s=this.comments.indexOf(e),n=Object.assign({},e);n.lesson_id=lesson_id,a.$http.post(t,n).then(e=>{a.snackbar=!0,a.snackbar_text=e.body.message,a.snackbar_type="primary","success"==e.body.status&&a.comments.splice(s,1)},e=>{a.send_comment_loading=!1,a.snackbar=!0,a.snackbar_text="Hubo un error inesperado al publicar el comentario",a.snackbar_type="primary"})},deleteAnswer(e){var a=this,t=api_url+"lesson-comments/delete/",s=this.comments.indexOf(e),n=Object.assign({},e);n.lesson_id=lesson_id,a.$http.post(t,n).then(e=>{a.snackbar=!0,a.snackbar_text=e.body.message,a.snackbar_type="primary","success"==e.body.status&&a.comments.splice(s,1)},e=>{a.send_comment_loading=!1,a.snackbar=!0,a.snackbar_text="Hubo un error inesperado al publicar el comentario",a.snackbar_type="primary"})},getFullName:e=>e.first_name+" "+e.last_name,fromNow(e){var a=moment.tz(e,"Europe/Berlin");return a.tz(timezone).fromNow()},getExt(e){var a=e,t=a.split("/"),s=t[t.length-1].split(".");return s[1]},getExtIcon(e){var a=e,t=a.split("/"),s=t[t.length-1].split("."),n="";switch(s[1]){case"pdf":n="pdf";break;case"docx":case"doc":n="word";break;case"ppt":case"pptx":case"ppt":n="powerpoint";break;case"xls":n="excel";break;default:n="document"}return n},isLocalFile:e=>!!e.includes(domain),saveFile(e,a){var t=this;a=void 0===a?t:a;var s=e.substring(e.lastIndexOf("/")+1).split("?")[0];t.$http.get(e,{responseType:"blob",progress(e){e.lengthComputable&&(a.percent_loading_active=!0,a.percent_loading=e.loaded/e.total*100)}}).then(e=>{var a=document.createElement("a");a.href=window.URL.createObjectURL(e.body),a.download=s,a.style.display="none",document.body.appendChild(a),a.click(),delete a})}}});