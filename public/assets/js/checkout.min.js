Vue.use(VueTelInputVuetify,{vuetify:vuetify}),moment.locale("ro");let vm=new Vue({vuetify:vuetify,el:"#app-container",data:{already_paid:!1,loading:!1,loading_btn:!1,alert:!1,alert_type:!1,alert_message:!1,tab:null,nav_tab:null,notifications:[],birthdate_modal:!1,validations:validations,course_id:url_params.get("course_id"),section_id:url_params.get("section"),title:url_params.get("course"),extra:url_params.get("extra"),personal_info:basic_info,paypal:{},children:new Children({uid:uid}),initial_pay:0,stripeElements:Object,stripePayment:Object,genders:[{text:"Bărbat",value:"M"},{text:"Femeie",value:"F"}],section:{},info:{course_id:"",total_pay:0,children:[],payment_method:"Paypal",meta:{USD:0,usd_tax_day:0}}},computed:{FullName(){return this.personal_info.first_name+" "+this.personal_info.last_name},AmountInUSD(){var e=this.info.total_pay/this.info.meta.usd_tax_day,t=new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RON"});return t.format(e)}},created(){check_google_user()},mounted(){this.initialize()},methods:{initialize(){var e=this,t=api_url+"courses/get/"+e.course_id;e.checkout_loading=!0,e.children.load(),e.$http.get(t).then(t=>{if(e.checkout_loading=!1,t.body.length>0){var a=t.body[0];e.info.course_id=e.course_id,e.info.type=1,e.initial_pay=a.price,e.getRONtoUSDTax(),e.$http.get(api_url+"course-sections/get/"+e.section_id).then(t=>{t.body.length>0&&(e.checkout_loading=!1,e.section=t.body[0])})}},e=>{})},fillPpCheckout(){var e=this;if(total_pay=e.info.total_pay,pp_pay=e.info.meta.USD,"undefined"==typeof paypal)return!1;null!=e.$refs.paypal_container&&(e.$refs.paypal_container.innerHTML=""),e.info.total_pay>=e.initial_pay&&paypal.Buttons({style:{color:"blue",shape:"pill",label:"pay",height:40},createOrder:(t,a)=>a.order.create({purchase_units:[{amount:{value:pp_pay,breakdown:{item_total:{value:pp_pay,currency_code:"USD"}}},items:[{name:e.title,unit_amount:{value:pp_pay,currency_code:"USD"},quantity:"1"}]}]}),onApprove:(t,a)=>a.order.capture().then(t=>{e.info.meta.pp_order_id=t.id,e.info.meta.pp_transaction_id=t.purchase_units[0].payments.captures[0].id,e.info.meta.pp_state=1,e.info.meta.total_paid=pp_pay,e.pay()})}).render("#paypal-button-container")},fillStripeCheckout(){var e=this,t=api_url+"checkout/stripe-intent-payment";e.stripe_loading=!0,e.stripe_enabled=!1;var a={total_pay:e.info.total_pay};e.$http.post(t,a).then(t=>{e.stripe_loading=!1,t.body.hasOwnProperty("clientSecret")&&(e.info.meta.stripeClientSecret=t.clientSecret,e.stripeElements=stripe.elements({clientSecret:t.body.clientSecret}),e.stripePayment=e.stripeElements.create("payment",{business:{name:"Woobit"},billingDetails:{email:e.personal_info.email,name:e.personal_info.first_name+" "+e.personal_info.last_name,phone:e.personal_info.telephone,address:{line1:e.personal_info.address}}}),e.stripePayment.mount("#payment-form"),e.stripe_enabled=!0)})},checkStripePaymentStatus(){var e=this;let t=new URLSearchParams(window.location.search).get("payment_intent_client_secret");if(!t)return;api_url;let{paymentIntent:a}=stripe.retrievePaymentIntent(t);switch(e.info.meta.stripe_payment_status=a.status,a.status){case"succeeded":case"processing":e.stripe_order_loading=!0,e.$http.get(api_url,e.info).then(t=>{e.stripe_order_loading=!1,e.alert=!0,e.alert_message=t.body.message,e.alert_type=t.body.status});break;case"requires_payment_method":e.alert=!0,e.alert_message="Plata dvs. nu a fost efectuată cu succes, vă rugăm să încercați din nou.",e.alert_type="warning";break;default:e.alert=!0,e.alert_message="Ceva a mers prost.",e.alert_type="error"}},getInput(e,t){this.personal_info.telephone=t.number.international},pay(){var e=this,t=e.info;e.loading_btn=!0,t.meta.first_name=e.personal_info.first_name,t.meta.user_email=e.personal_info.email,t.meta.last_name=e.personal_info.last_name,t.meta.telephone=e.personal_info.telephone,t.meta.address=e.personal_info.address,t.meta.course=e.title,t.section=e.section;var a=api_url+"orders/create";e.$http.post(a,t).then(t=>{e.loading_btn=!1,e.alert=!0,e.alert_message=t.body.message,e.alert_type=t.body.status,"success"==t.body.status&&(e.already_paid=!0,window.location=domain+"/profil-lector/view?tab=orders_container")},t=>{e.loading_btn=!1})},getRONtoUSDTax(){var e=this,t=`https://freecurrencyapi.net/api/v2/latest?apikey=${free_currency_api_key}&base_currency=USD`;e.info.meta.usd_tax_day<=0?e.$http.get(t).then(t=>{t.body.data.hasOwnProperty("RON")&&(e.info.meta.usd_tax_day=t.body.data.RON,e.info.meta.USD=(e.info.total_pay/e.info.meta.usd_tax_day).toFixed(2),e.fillPpCheckout(),e.fillStripeCheckout())},e=>{}):(e.info.meta.USD=(e.info.total_pay/e.info.meta.usd_tax_day).toFixed(2),e.fillPpCheckout(),e.fillStripeCheckout())},getFormatStartDate:e=>moment(e).format("LL"),getFrecuencyText(e,t){let a="",n="";switch(e){case"1":n=" pe săptămână",a=t<=1?`O dată ${n}`:`De ${t} ori ${n}`;break;case"2":n=" pe lună",a=$classes<=1?`O dată ${n}`:`De ${t} ori ${n}`}return a}}});